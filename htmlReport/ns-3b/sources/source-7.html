


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > MainToolBar</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.jabref.gui.frame</a>
</div>

<h1>Coverage Summary for Class: MainToolBar (org.jabref.gui.frame)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">MainToolBar</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/77)
  </span>
</td>
</tr>
  <tr>
    <td class="name">MainToolBar$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">MainToolBar$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/85)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.jabref.gui.frame;
&nbsp;
&nbsp;import javafx.concurrent.Task;
&nbsp;import javafx.geometry.Orientation;
&nbsp;import javafx.scene.Group;
&nbsp;import javafx.scene.control.Button;
&nbsp;import javafx.scene.control.ProgressIndicator;
&nbsp;import javafx.scene.control.Separator;
&nbsp;import javafx.scene.control.ToolBar;
&nbsp;import javafx.scene.control.Tooltip;
&nbsp;import javafx.scene.layout.HBox;
&nbsp;import javafx.scene.layout.Priority;
&nbsp;import javafx.scene.layout.Region;
&nbsp;import javafx.scene.shape.Rectangle;
&nbsp;
&nbsp;import org.jabref.gui.ClipBoardManager;
&nbsp;import org.jabref.gui.DialogService;
&nbsp;import org.jabref.gui.LibraryTabContainer;
&nbsp;import org.jabref.gui.StateManager;
&nbsp;import org.jabref.gui.actions.ActionFactory;
&nbsp;import org.jabref.gui.actions.SimpleCommand;
&nbsp;import org.jabref.gui.actions.StandardActions;
&nbsp;import org.jabref.gui.citationkeypattern.GenerateCitationKeyAction;
&nbsp;import org.jabref.gui.cleanup.CleanupAction;
&nbsp;import org.jabref.gui.edit.EditAction;
&nbsp;import org.jabref.gui.edit.OpenBrowserAction;
&nbsp;import org.jabref.gui.exporter.SaveAction;
&nbsp;import org.jabref.gui.importer.NewDatabaseAction;
&nbsp;import org.jabref.gui.importer.NewEntryAction;
&nbsp;import org.jabref.gui.importer.actions.OpenDatabaseAction;
&nbsp;import org.jabref.gui.preferences.GuiPreferences;
&nbsp;import org.jabref.gui.push.GuiPushToApplicationCommand;
&nbsp;import org.jabref.gui.search.GlobalSearchBar;
&nbsp;import org.jabref.gui.theme.ThemeManager;
&nbsp;import org.jabref.gui.undo.CountingUndoManager;
&nbsp;import org.jabref.gui.undo.RedoAction;
&nbsp;import org.jabref.gui.undo.UndoAction;
&nbsp;import org.jabref.logic.ai.AiService;
&nbsp;import org.jabref.logic.l10n.Localization;
&nbsp;import org.jabref.logic.util.TaskExecutor;
&nbsp;import org.jabref.model.entry.BibEntryTypesManager;
&nbsp;import org.jabref.model.util.FileUpdateMonitor;
&nbsp;
&nbsp;import com.tobiasdiez.easybind.EasyBind;
&nbsp;import com.tobiasdiez.easybind.Subscription;
&nbsp;import org.controlsfx.control.PopOver;
&nbsp;import org.controlsfx.control.TaskProgressView;
&nbsp;
&nbsp;public class MainToolBar extends ToolBar {
&nbsp;    private final LibraryTabContainer frame;
&nbsp;    private final GuiPushToApplicationCommand pushToApplicationCommand;
&nbsp;    private final GlobalSearchBar globalSearchBar;
&nbsp;    private final DialogService dialogService;
&nbsp;    private final StateManager stateManager;
&nbsp;    private final GuiPreferences preferences;
&nbsp;    private final AiService aiService;
&nbsp;    private final FileUpdateMonitor fileUpdateMonitor;
&nbsp;    private final TaskExecutor taskExecutor;
&nbsp;    private final BibEntryTypesManager entryTypesManager;
&nbsp;    private final ClipBoardManager clipBoardManager;
&nbsp;    private SimpleCommand backCommand;
&nbsp;    private SimpleCommand forwardCommand;
&nbsp;    private final CountingUndoManager undoManager;
&nbsp;
&nbsp;    private PopOver entryFromIdPopOver;
&nbsp;    private PopOver progressViewPopOver;
&nbsp;    private Subscription taskProgressSubscription;
&nbsp;
&nbsp;    public MainToolBar(LibraryTabContainer tabContainer,
&nbsp;                       GuiPushToApplicationCommand pushToApplicationCommand,
&nbsp;                       GlobalSearchBar globalSearchBar,
&nbsp;                       DialogService dialogService,
&nbsp;                       StateManager stateManager,
&nbsp;                       GuiPreferences preferences,
&nbsp;                       AiService aiService,
&nbsp;                       FileUpdateMonitor fileUpdateMonitor,
&nbsp;                       TaskExecutor taskExecutor,
&nbsp;                       BibEntryTypesManager entryTypesManager,
&nbsp;                       ClipBoardManager clipBoardManager,
<b class="nc">&nbsp;                       CountingUndoManager undoManager) {</b>
<b class="nc">&nbsp;        this.frame = tabContainer;</b>
<b class="nc">&nbsp;        this.pushToApplicationCommand = pushToApplicationCommand;</b>
<b class="nc">&nbsp;        this.globalSearchBar = globalSearchBar;</b>
<b class="nc">&nbsp;        this.dialogService = dialogService;</b>
<b class="nc">&nbsp;        this.stateManager = stateManager;</b>
<b class="nc">&nbsp;        this.preferences = preferences;</b>
<b class="nc">&nbsp;        this.aiService = aiService;</b>
<b class="nc">&nbsp;        this.fileUpdateMonitor = fileUpdateMonitor;</b>
<b class="nc">&nbsp;        this.taskExecutor = taskExecutor;</b>
<b class="nc">&nbsp;        this.entryTypesManager = entryTypesManager;</b>
<b class="nc">&nbsp;        this.clipBoardManager = clipBoardManager;</b>
<b class="nc">&nbsp;        this.undoManager = undoManager;</b>
&nbsp;
<b class="nc">&nbsp;        createToolBar();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void createToolBar() {
<b class="nc">&nbsp;        final ActionFactory factory = new ActionFactory();</b>
&nbsp;
<b class="nc">&nbsp;        final Region leftSpacer = new Region();</b>
<b class="nc">&nbsp;        final Region rightSpacer = new Region();</b>
&nbsp;
<b class="nc">&nbsp;        final Button pushToApplicationButton = factory.createIconButton(pushToApplicationCommand.getAction(), pushToApplicationCommand);</b>
<b class="nc">&nbsp;        pushToApplicationCommand.registerReconfigurable(pushToApplicationButton);</b>
<b class="nc">&nbsp;        initNavigationCommands();</b>
&nbsp;
&nbsp;        // Setup Toolbar
&nbsp;
<b class="nc">&nbsp;        getItems().addAll(</b>
&nbsp;                new HBox(
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.NEW_LIBRARY, new NewDatabaseAction(frame, preferences)),</b>
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.OPEN_LIBRARY, new OpenDatabaseAction(frame, preferences, aiService, dialogService, stateManager, fileUpdateMonitor, entryTypesManager, undoManager, clipBoardManager, taskExecutor)),</b>
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.SAVE_LIBRARY, new SaveAction(SaveAction.SaveMethod.SAVE, frame::getCurrentLibraryTab, dialogService, preferences, stateManager))),</b>
&nbsp;
&nbsp;                leftSpacer,
&nbsp;
&nbsp;                globalSearchBar,
&nbsp;
&nbsp;                rightSpacer,
&nbsp;
&nbsp;                new HBox(
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.ADD_ENTRY_IMMEDIATE, new NewEntryAction(true, frame::getCurrentLibraryTab, dialogService, preferences, stateManager)),</b>
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.ADD_ENTRY, new NewEntryAction(false, frame::getCurrentLibraryTab, dialogService, preferences, stateManager)),</b>
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.DELETE_ENTRY, new EditAction(StandardActions.DELETE_ENTRY, frame::getCurrentLibraryTab, stateManager, undoManager))),</b>
&nbsp;
&nbsp;                new Separator(Orientation.VERTICAL),
&nbsp;
&nbsp;                new HBox(
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.BACK, backCommand),</b>
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.FORWARD, forwardCommand)),</b>
&nbsp;
&nbsp;                new Separator(Orientation.VERTICAL),
&nbsp;
&nbsp;                new HBox(
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.UNDO, new UndoAction(frame::getCurrentLibraryTab, undoManager, dialogService, stateManager)),</b>
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.REDO, new RedoAction(frame::getCurrentLibraryTab, undoManager, dialogService, stateManager)),</b>
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.CUT, new EditAction(StandardActions.CUT, frame::getCurrentLibraryTab, stateManager, undoManager)),</b>
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.COPY, new EditAction(StandardActions.COPY, frame::getCurrentLibraryTab, stateManager, undoManager)),</b>
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.PASTE, new EditAction(StandardActions.PASTE, frame::getCurrentLibraryTab, stateManager, undoManager))),</b>
&nbsp;
&nbsp;                new Separator(Orientation.VERTICAL),
&nbsp;
&nbsp;                new HBox(
&nbsp;                        pushToApplicationButton,
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.GENERATE_CITE_KEYS, new GenerateCitationKeyAction(frame::getCurrentLibraryTab, dialogService, stateManager, taskExecutor, preferences, undoManager)),</b>
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.CLEANUP_ENTRIES, new CleanupAction(frame::getCurrentLibraryTab, preferences, dialogService, stateManager, taskExecutor, undoManager))),</b>
&nbsp;
&nbsp;                new Separator(Orientation.VERTICAL),
&nbsp;
&nbsp;                new HBox(
<b class="nc">&nbsp;                        createTaskIndicator()),</b>
&nbsp;
&nbsp;                new Separator(Orientation.VERTICAL),
&nbsp;
&nbsp;                new HBox(
<b class="nc">&nbsp;                        factory.createIconButton(StandardActions.OPEN_GITHUB, new OpenBrowserAction(&quot;https://github.com/JabRef/jabref&quot;, dialogService, preferences.getExternalApplicationsPreferences()))));</b>
&nbsp;
<b class="nc">&nbsp;        leftSpacer.setPrefWidth(50);</b>
<b class="nc">&nbsp;        leftSpacer.setMinWidth(Region.USE_PREF_SIZE);</b>
<b class="nc">&nbsp;        leftSpacer.setMaxWidth(Region.USE_PREF_SIZE);</b>
<b class="nc">&nbsp;        HBox.setHgrow(globalSearchBar, Priority.ALWAYS);</b>
<b class="nc">&nbsp;        HBox.setHgrow(rightSpacer, Priority.SOMETIMES);</b>
&nbsp;
<b class="nc">&nbsp;        getStyleClass().add(&quot;mainToolbar&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    Group createTaskIndicator() {
<b class="nc">&nbsp;        ProgressIndicator indicator = new ProgressIndicator();</b>
<b class="nc">&nbsp;        indicator.getStyleClass().add(&quot;progress-indicatorToolbar&quot;);</b>
<b class="nc">&nbsp;        indicator.progressProperty().bind(stateManager.getTasksProgress());</b>
&nbsp;
<b class="nc">&nbsp;        Tooltip someTasksRunning = new Tooltip(Localization.lang(&quot;Background tasks are running&quot;));</b>
<b class="nc">&nbsp;        Tooltip noTasksRunning = new Tooltip(Localization.lang(&quot;Background tasks are finished&quot;));</b>
<b class="nc">&nbsp;        indicator.setTooltip(noTasksRunning);</b>
<b class="nc">&nbsp;        stateManager.getAnyTaskRunning().addListener((observable, oldValue, newValue) -&gt; {</b>
<b class="nc">&nbsp;            if (newValue) {</b>
<b class="nc">&nbsp;                indicator.setTooltip(someTasksRunning);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                indicator.setTooltip(noTasksRunning);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
&nbsp;        // The label of the indicator cannot be removed with styling. Therefore,
&nbsp;        // hide it and clip it to a square of (width x width) each time width is updated.
<b class="nc">&nbsp;        indicator.widthProperty().addListener((observable, oldValue, newValue) -&gt; {</b>
&nbsp;            // The indeterminate spinner is wider than the determinate spinner.
&nbsp;            // We must make sure they are the same width for the clipping to result in a square of the same size always.
<b class="nc">&nbsp;            if (!indicator.isIndeterminate()) {</b>
<b class="nc">&nbsp;                indicator.setPrefWidth(newValue.doubleValue());</b>
&nbsp;            }
<b class="nc">&nbsp;            if (newValue.doubleValue() &gt; 0) {</b>
<b class="nc">&nbsp;                Rectangle clip = new Rectangle(newValue.doubleValue(), newValue.doubleValue());</b>
<b class="nc">&nbsp;                indicator.setClip(clip);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        indicator.setOnMouseClicked(event -&gt; {</b>
<b class="nc">&nbsp;            if ((progressViewPopOver != null) &amp;&amp; (progressViewPopOver.isShowing())) {</b>
<b class="nc">&nbsp;                progressViewPopOver.hide();</b>
<b class="nc">&nbsp;                taskProgressSubscription.unsubscribe();</b>
&nbsp;                return;
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            TaskProgressView&lt;Task&lt;?&gt;&gt; taskProgressView = new TaskProgressView&lt;&gt;();</b>
<b class="nc">&nbsp;            taskProgressSubscription = EasyBind.bindContent(taskProgressView.getTasks(), stateManager.getRunningBackgroundTasks());</b>
<b class="nc">&nbsp;            taskProgressView.setRetainTasks(false);</b>
<b class="nc">&nbsp;            taskProgressView.setGraphicFactory(task -&gt; ThemeManager.getDownloadIconTitleMap.getOrDefault(task.getTitle(), null));</b>
&nbsp;
<b class="nc">&nbsp;            if (progressViewPopOver == null) {</b>
<b class="nc">&nbsp;                progressViewPopOver = new PopOver(taskProgressView);</b>
<b class="nc">&nbsp;                progressViewPopOver.setTitle(Localization.lang(&quot;Background tasks&quot;));</b>
<b class="nc">&nbsp;                progressViewPopOver.setArrowLocation(PopOver.ArrowLocation.RIGHT_TOP);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            progressViewPopOver.setContentNode(taskProgressView);</b>
<b class="nc">&nbsp;            progressViewPopOver.show(indicator);</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        return new Group(indicator);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void initNavigationCommands() {
<b class="nc">&nbsp;        backCommand = new SimpleCommand() {</b>
&nbsp;            {
<b class="nc">&nbsp;                executable.bind(stateManager.canGoBackProperty());</b>
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            public void execute() {
<b class="nc">&nbsp;                if (frame.getCurrentLibraryTab() != null) {</b>
<b class="nc">&nbsp;                    frame.getCurrentLibraryTab().back();</b>
&nbsp;                }
&nbsp;            }
&nbsp;        };
&nbsp;
<b class="nc">&nbsp;        forwardCommand = new SimpleCommand() {</b>
&nbsp;            {
<b class="nc">&nbsp;                executable.bind(stateManager.canGoForwardProperty());</b>
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            public void execute() {
<b class="nc">&nbsp;                if (frame.getCurrentLibraryTab() != null) {</b>
<b class="nc">&nbsp;                    frame.getCurrentLibraryTab().forward();</b>
&nbsp;                }
&nbsp;            }
&nbsp;        };
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-09-29 22:51</div>
</div>
</body>
</html>

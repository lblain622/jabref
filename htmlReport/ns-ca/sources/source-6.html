


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > FetcherException</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.jabref.logic.importer</a>
</div>

<h1>Coverage Summary for Class: FetcherException (org.jabref.logic.importer)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">FetcherException</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/39)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.jabref.logic.importer;
&nbsp;
&nbsp;import java.io.IOException;
&nbsp;import java.net.URL;
&nbsp;import java.util.Optional;
&nbsp;import java.util.regex.Pattern;
&nbsp;
&nbsp;import org.jabref.logic.JabRefException;
&nbsp;import org.jabref.model.http.SimpleHttpResponse;
&nbsp;import org.jabref.model.strings.StringUtil;
&nbsp;
&nbsp;import org.slf4j.Logger;
&nbsp;import org.slf4j.LoggerFactory;
&nbsp;
&nbsp;public class FetcherException extends JabRefException {
<b class="nc">&nbsp;    private static final Logger LOGGER = LoggerFactory.getLogger(FetcherException.class);</b>
&nbsp;    private static final String API_KEY_PARAM_NAME = &quot;apiKeyParamName&quot;;
<b class="nc">&nbsp;    private static final Pattern API_KEY_PATTERN = Pattern.compile(&quot;(?i)(?&lt;&quot; + API_KEY_PARAM_NAME + &quot;&gt;api|key|api[-_]?key)=[^&amp;]*&quot;);</b>
&nbsp;    private static final String REDACTED_STRING = &quot;[REDACTED]&quot;;
&nbsp;
&nbsp;    private final String url;
&nbsp;    private final SimpleHttpResponse httpResponse;
&nbsp;
&nbsp;    public FetcherException(String url, SimpleHttpResponse httpResponse) {
&nbsp;        // Empty string handled at org.jabref.logic.importer.FetcherException.getPrefix.
<b class="nc">&nbsp;        super(&quot;&quot;);</b>
<b class="nc">&nbsp;        this.url = url;</b>
<b class="nc">&nbsp;        this.httpResponse = httpResponse;</b>
&nbsp;    }
&nbsp;
&nbsp;    protected FetcherException(URL url, SimpleHttpResponse httpResponse) {
<b class="nc">&nbsp;        this(url.toString(), httpResponse);</b>
&nbsp;    }
&nbsp;
&nbsp;    public FetcherException(URL url, Throwable cause) {
<b class="nc">&nbsp;        super(cause);</b>
<b class="nc">&nbsp;        httpResponse = null;</b>
<b class="nc">&nbsp;        this.url = url.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public FetcherException(URL url, String errorMessage, Throwable cause) {
<b class="nc">&nbsp;        super(errorMessage, cause);</b>
<b class="nc">&nbsp;        httpResponse = null;</b>
<b class="nc">&nbsp;        this.url = url.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public FetcherException(String errorMessage, Throwable cause) {
&nbsp;        // TODO: Convert IOException e to FetcherClientException
&nbsp;        //       Same TODO as in org.jabref.logic.importer.EntryBasedParserFetcher.performSearch.
&nbsp;        //       Maybe do this in org.jabref.logic.importer.FetcherException.getLocalizedMessage
&nbsp;
&nbsp;        // Idea (from org.jabref.logic.importer.fetcher.GoogleScholar.performSearchPaged)
&nbsp;        // if (e.getMessage().contains(&quot;Server returned HTTP response code: 503 for URL&quot;)) {
<b class="nc">&nbsp;        super(errorMessage, cause);</b>
<b class="nc">&nbsp;        if (LOGGER.isDebugEnabled() &amp;&amp; (cause instanceof IOException)) {</b>
<b class="nc">&nbsp;            LOGGER.debug(&quot;I/O exception&quot;, cause);</b>
&nbsp;        }
<b class="nc">&nbsp;        httpResponse = null;</b>
<b class="nc">&nbsp;        url = null;</b>
&nbsp;    }
&nbsp;
&nbsp;    public FetcherException(String errorMessage) {
<b class="nc">&nbsp;        super(errorMessage);</b>
<b class="nc">&nbsp;        httpResponse = null;</b>
<b class="nc">&nbsp;        url = null;</b>
&nbsp;    }
&nbsp;
&nbsp;    public FetcherException(String errorMessage, String localizedMessage, Throwable cause) {
<b class="nc">&nbsp;        super(errorMessage, localizedMessage, cause);</b>
<b class="nc">&nbsp;        httpResponse = null;</b>
<b class="nc">&nbsp;        url = null;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getLocalizedMessage() {
&nbsp;        // TODO: This should be moved to a separate class converting &quot;any&quot; exception object to a localized message
&nbsp;        // TODO: 5% of the &quot;new-ers&quot; pass a &quot;real&quot; localized message. See org.jabref.logic.importer.fetcher.GoogleScholar.addHitsFromQuery. We should maybe make use of this (and rewrite the whole message handling)
&nbsp;        // TODO: Try to convert IOException to some more meaningful information here (or at org.jabref.gui.DialogService.showErrorDialogAndWait(org.jabref.logic.importer.FetcherException)). See also org.jabref.logic.net.URLDownload.openConnection
<b class="nc">&nbsp;        if (httpResponse != null) {</b>
&nbsp;            // We decided to not &quot;translate&quot; technical terms (URL, HTTP)
<b class="nc">&nbsp;            return getPrefix() + &quot;URL: %s\nHTTP %d %s\n%s&quot;.formatted(getRedactedUrl(), httpResponse.statusCode(), httpResponse.responseMessage(), httpResponse.responseBody());</b>
<b class="nc">&nbsp;        } else if (url != null) {</b>
<b class="nc">&nbsp;            return getPrefix() + &quot;URL: %s&quot;.formatted(getRedactedUrl());</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return super.getLocalizedMessage();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    String getRedactedUrl() {
<b class="nc">&nbsp;        return getRedactedUrl(url);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getRedactedUrl(String source) {
<b class="nc">&nbsp;        return API_KEY_PATTERN.matcher(source).replaceAll(&quot;${&quot; + API_KEY_PARAM_NAME + &quot;}=&quot; + REDACTED_STRING);</b>
&nbsp;    }
&nbsp;
&nbsp;    private String getPrefix() {
<b class="nc">&nbsp;        String superLocalizedMessage = super.getLocalizedMessage();</b>
<b class="nc">&nbsp;        if (!StringUtil.isBlank(superLocalizedMessage)) {</b>
<b class="nc">&nbsp;            return superLocalizedMessage + &quot;\n&quot;;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return &quot;&quot;;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public Optional&lt;SimpleHttpResponse&gt; getHttpResponse() {
<b class="nc">&nbsp;        return Optional.ofNullable(httpResponse);</b>
&nbsp;    }
&nbsp;
&nbsp;    public Optional&lt;String&gt; getUrl() {
<b class="nc">&nbsp;        return Optional.ofNullable(url);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static FetcherException of(URL url, SimpleHttpResponse simpleHttpResponse) {
<b class="nc">&nbsp;        if (simpleHttpResponse.statusCode() &gt;= 500) {</b>
<b class="nc">&nbsp;            return new FetcherServerException(url, simpleHttpResponse);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return new FetcherClientException(url, simpleHttpResponse);</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-09-29 22:51</div>
</div>
</body>
</html>




<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > BindingsHelper</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.jabref.gui.util</a>
</div>

<h1>Coverage Summary for Class: BindingsHelper (org.jabref.gui.util)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">BindingsHelper</td>
<td class="coverageStat">
  <span class="percent">
    5.3%
  </span>
  <span class="absValue">
    (1/19)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    4.4%
  </span>
  <span class="absValue">
    (3/68)
  </span>
</td>
</tr>
  <tr>
    <td class="name">BindingsHelper$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">BindingsHelper$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">BindingsHelper$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">BindingsHelper$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">BindingsHelper$BidirectionalBinding</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">BindingsHelper$BidirectionalListBinding</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">BindingsHelper$BidirectionalMapBinding</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    2.6%
  </span>
  <span class="absValue">
    (1/39)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/32)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    2.6%
  </span>
  <span class="absValue">
    (3/117)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.jabref.gui.util;
&nbsp;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.function.Consumer;
&nbsp;import java.util.function.Function;
&nbsp;import java.util.function.Predicate;
&nbsp;
&nbsp;import javafx.beans.binding.BooleanBinding;
&nbsp;import javafx.beans.binding.ObjectBinding;
&nbsp;import javafx.beans.binding.StringBinding;
&nbsp;import javafx.beans.property.ListProperty;
&nbsp;import javafx.beans.property.Property;
&nbsp;import javafx.beans.value.ChangeListener;
&nbsp;import javafx.beans.value.ObservableValue;
&nbsp;import javafx.collections.FXCollections;
&nbsp;import javafx.collections.ListChangeListener;
&nbsp;import javafx.collections.MapChangeListener;
&nbsp;import javafx.collections.ObservableList;
&nbsp;import javafx.collections.ObservableMap;
&nbsp;import javafx.css.PseudoClass;
&nbsp;import javafx.scene.Node;
&nbsp;import javafx.scene.control.Tab;
&nbsp;
&nbsp;import org.jabref.gui.LibraryTab;
&nbsp;import org.jabref.model.database.BibDatabaseContext;
&nbsp;
&nbsp;import com.tobiasdiez.easybind.EasyBind;
&nbsp;import com.tobiasdiez.easybind.PreboundBinding;
&nbsp;import com.tobiasdiez.easybind.Subscription;
&nbsp;
&nbsp;/**
&nbsp; * Helper methods for javafx binding. Some methods are taken from https://bugs.openjdk.java.net/browse/JDK-8134679
&nbsp; */
&nbsp;public class BindingsHelper {
&nbsp;
&nbsp;    private BindingsHelper() {
&nbsp;    }
&nbsp;
&nbsp;    public static Subscription includePseudoClassWhen(Node node, PseudoClass pseudoClass, ObservableValue&lt;? extends Boolean&gt; condition) {
<b class="nc">&nbsp;        Consumer&lt;Boolean&gt; changePseudoClass = value -&gt; node.pseudoClassStateChanged(pseudoClass, value);</b>
<b class="nc">&nbsp;        Subscription subscription = EasyBind.subscribe(condition, changePseudoClass);</b>
&nbsp;
&nbsp;        // Put the pseudo class there depending on the current value
<b class="nc">&nbsp;        changePseudoClass.accept(condition.getValue());</b>
<b class="nc">&nbsp;        return subscription;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T, U&gt; ObservableList&lt;U&gt; map(ObservableValue&lt;T&gt; source, Function&lt;T, List&lt;U&gt;&gt; mapper) {
<b class="nc">&nbsp;        PreboundBinding&lt;List&lt;U&gt;&gt; binding = new PreboundBinding&lt;&gt;(source) {</b>
&nbsp;            @Override
&nbsp;            protected List&lt;U&gt; computeValue() {
<b class="nc">&nbsp;                return mapper.apply(source.getValue());</b>
&nbsp;            }
&nbsp;        };
&nbsp;
<b class="nc">&nbsp;        ObservableList&lt;U&gt; list = FXCollections.observableArrayList();</b>
<b class="nc">&nbsp;        binding.addListener((observable, oldValue, newValue) -&gt; list.setAll(newValue));</b>
<b class="nc">&nbsp;        return list;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Binds propertyA bidirectional to propertyB using the provided map functions to convert between them.
&nbsp;     */
&nbsp;    public static &lt;A, B&gt; void bindBidirectional(Property&lt;A&gt; propertyA, Property&lt;B&gt; propertyB, Function&lt;A, B&gt; mapAtoB, Function&lt;B, A&gt; mapBtoA) {
<b class="nc">&nbsp;        Consumer&lt;B&gt; updateA = newValueB -&gt; propertyA.setValue(mapBtoA.apply(newValueB));</b>
<b class="nc">&nbsp;        Consumer&lt;A&gt; updateB = newValueA -&gt; propertyB.setValue(mapAtoB.apply(newValueA));</b>
<b class="nc">&nbsp;        bindBidirectional(propertyA, propertyB, updateA, updateB);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Binds propertyA bidirectional to propertyB while using updateB to update propertyB when propertyA changed.
&nbsp;     */
&nbsp;    public static &lt;A&gt; void bindBidirectional(Property&lt;A&gt; propertyA, ObservableValue&lt;A&gt; propertyB, Consumer&lt;A&gt; updateB) {
<b class="nc">&nbsp;        bindBidirectional(propertyA, propertyB, propertyA::setValue, updateB);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Binds propertyA bidirectional to propertyB using updateB to update propertyB when propertyA changed and similar for updateA.
&nbsp;     */
&nbsp;    public static &lt;A, B&gt; void bindBidirectional(ObservableValue&lt;A&gt; propertyA, ObservableValue&lt;B&gt; propertyB, Consumer&lt;B&gt; updateA, Consumer&lt;A&gt; updateB) {
<b class="nc">&nbsp;        final BidirectionalBinding&lt;A, B&gt; binding = new BidirectionalBinding&lt;&gt;(propertyA, propertyB, updateA, updateB);</b>
&nbsp;
&nbsp;        // use updateB as initial source
<b class="nc">&nbsp;        updateA.accept(propertyB.getValue());</b>
&nbsp;
<b class="nc">&nbsp;        propertyA.addListener(binding.getChangeListenerA());</b>
<b class="nc">&nbsp;        propertyB.addListener(binding.getChangeListenerB());</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;A, B&gt; void bindContentBidirectional(ObservableList&lt;A&gt; propertyA, ListProperty&lt;B&gt; propertyB, Consumer&lt;ObservableList&lt;B&gt;&gt; updateA, Consumer&lt;List&lt;A&gt;&gt; updateB) {
<b class="nc">&nbsp;        bindContentBidirectional(</b>
&nbsp;                propertyA,
&nbsp;                (ObservableValue&lt;ObservableList&lt;B&gt;&gt;) propertyB,
&nbsp;                updateA,
&nbsp;                updateB);
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;A, B&gt; void bindContentBidirectional(ObservableList&lt;A&gt; propertyA, ObservableValue&lt;B&gt; propertyB, Consumer&lt;B&gt; updateA, Consumer&lt;List&lt;A&gt;&gt; updateB) {
<b class="nc">&nbsp;        final BidirectionalListBinding&lt;A, B&gt; binding = new BidirectionalListBinding&lt;&gt;(propertyA, propertyB, updateA, updateB);</b>
&nbsp;
&nbsp;        // use property as initial source
<b class="nc">&nbsp;        updateA.accept(propertyB.getValue());</b>
&nbsp;
<b class="nc">&nbsp;        propertyA.addListener(binding);</b>
<b class="nc">&nbsp;        propertyB.addListener(binding);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;A, B&gt; void bindContentBidirectional(ListProperty&lt;A&gt; listProperty, Property&lt;B&gt; property, Function&lt;List&lt;A&gt;, B&gt; mapToB, Function&lt;B, List&lt;A&gt;&gt; mapToList) {
<b class="nc">&nbsp;        Consumer&lt;B&gt; updateList = newValueB -&gt; listProperty.setAll(mapToList.apply(newValueB));</b>
<b class="nc">&nbsp;        Consumer&lt;List&lt;A&gt;&gt; updateB = newValueList -&gt; property.setValue(mapToB.apply(newValueList));</b>
&nbsp;
<b class="nc">&nbsp;        bindContentBidirectional(</b>
&nbsp;                listProperty,
&nbsp;                property,
&nbsp;                updateList,
&nbsp;                updateB);
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;A, V, B&gt; void bindContentBidirectional(ObservableMap&lt;A, V&gt; propertyA, ObservableValue&lt;B&gt; propertyB, Consumer&lt;B&gt; updateA, Consumer&lt;Map&lt;A, V&gt;&gt; updateB) {
<b class="nc">&nbsp;        final BidirectionalMapBinding&lt;A, V, B&gt; binding = new BidirectionalMapBinding&lt;&gt;(propertyA, propertyB, updateA, updateB);</b>
&nbsp;
&nbsp;        // use list as initial source
<b class="nc">&nbsp;        updateB.accept(propertyA);</b>
&nbsp;
<b class="nc">&nbsp;        propertyA.addListener(binding);</b>
<b class="nc">&nbsp;        propertyB.addListener(binding);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;A, V, B&gt; void bindContentBidirectional(ObservableMap&lt;A, V&gt; propertyA, Property&lt;B&gt; propertyB, Consumer&lt;B&gt; updateA, Function&lt;Map&lt;A, V&gt;, B&gt; mapToB) {
<b class="nc">&nbsp;        Consumer&lt;Map&lt;A, V&gt;&gt; updateB = newValueList -&gt; propertyB.setValue(mapToB.apply(newValueList));</b>
<b class="nc">&nbsp;        bindContentBidirectional(</b>
&nbsp;                propertyA,
&nbsp;                propertyB,
&nbsp;                updateA,
&nbsp;                updateB);
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; ObservableValue&lt;T&gt; constantOf(T value) {
<b class="nc">&nbsp;        return new ObjectBinding&lt;&gt;() {</b>
&nbsp;            @Override
&nbsp;            protected T computeValue() {
<b class="nc">&nbsp;                return value;</b>
&nbsp;            }
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    public static ObservableValue&lt;Boolean&gt; constantOf(boolean value) {
<b class="nc">&nbsp;        return new BooleanBinding() {</b>
&nbsp;            @Override
&nbsp;            protected boolean computeValue() {
<b class="nc">&nbsp;                return value;</b>
&nbsp;            }
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    public static ObservableValue&lt;? extends String&gt; emptyString() {
<b class="nc">&nbsp;        return new StringBinding() {</b>
&nbsp;            @Override
&nbsp;            protected String computeValue() {
<b class="nc">&nbsp;                return &quot;&quot;;</b>
&nbsp;            }
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns a wrapper around the given list that posts changes on the JavaFX thread.
&nbsp;     */
&nbsp;    public static &lt;T&gt; ObservableList&lt;T&gt; forUI(ObservableList&lt;T&gt; list) {
<b class="nc">&nbsp;        return new UiThreadList&lt;&gt;(list);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; ObservableValue&lt;T&gt; ifThenElse(ObservableValue&lt;Boolean&gt; condition, T value, T other) {
<b class="nc">&nbsp;        return EasyBind.map(condition, conditionValue -&gt; {</b>
<b class="nc">&nbsp;            if (conditionValue) {</b>
<b class="nc">&nbsp;                return value;</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return other;</b>
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Invokes {@code subscriber} for the every new value of {@code observable}, but not for the current value.
&nbsp;     *
&nbsp;     * @param observable observable value to subscribe to
&nbsp;     * @param subscriber action to invoke for values of {@code observable}.
&nbsp;     * @return a subscription that can be used to stop invoking subscriber for any further {@code observable} changes.
&nbsp;     * @apiNote {@link EasyBind#subscribe(ObservableValue, Consumer)} is similar but also invokes the {@code subscriber} for the current value
&nbsp;     */
&nbsp;    public static &lt;T&gt; Subscription subscribeFuture(ObservableValue&lt;T&gt; observable, Consumer&lt;? super T&gt; subscriber) {
<b class="fc">&nbsp;        ChangeListener&lt;? super T&gt; listener = (obs, oldValue, newValue) -&gt; subscriber.accept(newValue);</b>
<b class="fc">&nbsp;        observable.addListener(listener);</b>
<b class="fc">&nbsp;        return () -&gt; observable.removeListener(listener);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static void bindContentFiltered(ObservableList&lt;Tab&gt; source, ObservableList&lt;BibDatabaseContext&gt; target, Predicate&lt;Tab&gt; filter) {
&nbsp;        // FIXME: See https://github.com/JabRef/jabref-koppor/pull/713 - workaround in place until issue is resolved.
&nbsp;        // Original code used FilteredList and EasyBind to filter and map tabs directly:
&nbsp;        // FilteredList&lt;Tab&gt; filteredTabs = new FilteredList&lt;&gt;(tabbedPane.getTabs());
&nbsp;        // filteredTabs.setPredicate(LibraryTab.class::isInstance);
&nbsp;        // openDatabaseList = EasyBind.map(filteredTabs, tab -&gt; ((LibraryTab) tab).getBibDatabaseContext());
&nbsp;        // EasyBind.bindContent(stateManager.getOpenDatabases(), openDatabaseList);
&nbsp;        // Once JabRef#713 is fixed, remove this comment and the bindContentFiltered() method, and restore the original code
&nbsp;
<b class="nc">&nbsp;        Function&lt;Tab, BibDatabaseContext&gt; tabToContext = tab -&gt; ((LibraryTab) tab).getBibDatabaseContext();</b>
&nbsp;        // Initial sync
<b class="nc">&nbsp;        target.setAll(source.stream()</b>
<b class="nc">&nbsp;                            .filter(filter)</b>
<b class="nc">&nbsp;                            .map(tabToContext)</b>
<b class="nc">&nbsp;                            .toList());</b>
&nbsp;
<b class="nc">&nbsp;        source.addListener((ListChangeListener&lt;Tab&gt;) change -&gt; {</b>
<b class="nc">&nbsp;            while (change.next()) {</b>
<b class="nc">&nbsp;                if (change.wasPermutated()) {</b>
&nbsp;                    // We need a fresh copy as permutation is much harder to mirror
<b class="nc">&nbsp;                    List&lt;BibDatabaseContext&gt; reordered = source.stream()</b>
<b class="nc">&nbsp;                                                               .filter(filter)</b>
<b class="nc">&nbsp;                                                               .map(tabToContext)</b>
<b class="nc">&nbsp;                                                               .toList();</b>
<b class="nc">&nbsp;                    target.setAll(reordered);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (change.wasRemoved()) {</b>
<b class="nc">&nbsp;                    for (Tab removed : change.getRemoved()) {</b>
<b class="nc">&nbsp;                        if (filter.test(removed)) {</b>
<b class="nc">&nbsp;                            target.remove(tabToContext.apply(removed));</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                if (change.wasAdded()) {</b>
<b class="nc">&nbsp;                    int sourceIndex = change.getFrom();</b>
<b class="nc">&nbsp;                    int targetIndex = 0;</b>
&nbsp;
&nbsp;                    // We need to add at the correct place - therefore, we need to find out the correct position
<b class="nc">&nbsp;                    for (int i = 0; i &lt; sourceIndex; i++) {</b>
<b class="nc">&nbsp;                        Tab tab = source.get(i);</b>
<b class="nc">&nbsp;                        if (filter.test(tab)) {</b>
<b class="nc">&nbsp;                            targetIndex++;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    for (Tab added : change.getAddedSubList()) {</b>
<b class="nc">&nbsp;                        if (filter.test(added)) {</b>
<b class="nc">&nbsp;                            target.add(targetIndex++, tabToContext.apply(added));</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    private static class BidirectionalBinding&lt;A, B&gt; {
&nbsp;
&nbsp;        private final ObservableValue&lt;A&gt; propertyA;
&nbsp;        private final Consumer&lt;B&gt; updateA;
&nbsp;        private final Consumer&lt;A&gt; updateB;
<b class="nc">&nbsp;        private boolean updating = false;</b>
&nbsp;
<b class="nc">&nbsp;        public BidirectionalBinding(ObservableValue&lt;A&gt; propertyA, ObservableValue&lt;B&gt; propertyB, Consumer&lt;B&gt; updateA, Consumer&lt;A&gt; updateB) {</b>
<b class="nc">&nbsp;            this.propertyA = propertyA;</b>
<b class="nc">&nbsp;            this.updateA = updateA;</b>
<b class="nc">&nbsp;            this.updateB = updateB;</b>
&nbsp;        }
&nbsp;
&nbsp;        public ChangeListener&lt;? super A&gt; getChangeListenerA() {
<b class="nc">&nbsp;            return this::changedA;</b>
&nbsp;        }
&nbsp;
&nbsp;        public ChangeListener&lt;? super B&gt; getChangeListenerB() {
<b class="nc">&nbsp;            return this::changedB;</b>
&nbsp;        }
&nbsp;
&nbsp;        public void changedA(ObservableValue&lt;? extends A&gt; observable, A oldValue, A newValue) {
<b class="nc">&nbsp;            updateLocked(updateB, oldValue, newValue);</b>
&nbsp;        }
&nbsp;
&nbsp;        public void changedB(ObservableValue&lt;? extends B&gt; observable, B oldValue, B newValue) {
<b class="nc">&nbsp;            updateLocked(updateA, oldValue, newValue);</b>
&nbsp;        }
&nbsp;
&nbsp;        private &lt;T&gt; void updateLocked(Consumer&lt;T&gt; update, T oldValue, T newValue) {
<b class="nc">&nbsp;            if (!updating) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    updating = true;</b>
<b class="nc">&nbsp;                    update.accept(newValue);</b>
&nbsp;                } finally {
<b class="nc">&nbsp;                    updating = false;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private static class BidirectionalListBinding&lt;A, B&gt; implements ListChangeListener&lt;A&gt;, ChangeListener&lt;B&gt; {
&nbsp;
&nbsp;        private final ObservableList&lt;A&gt; listProperty;
&nbsp;        private final ObservableValue&lt;B&gt; property;
&nbsp;        private final Consumer&lt;B&gt; updateA;
&nbsp;        private final Consumer&lt;List&lt;A&gt;&gt; updateB;
<b class="nc">&nbsp;        private boolean updating = false;</b>
&nbsp;
<b class="nc">&nbsp;        public BidirectionalListBinding(ObservableList&lt;A&gt; listProperty, ObservableValue&lt;B&gt; property, Consumer&lt;B&gt; updateA, Consumer&lt;List&lt;A&gt;&gt; updateB) {</b>
<b class="nc">&nbsp;            this.listProperty = listProperty;</b>
<b class="nc">&nbsp;            this.property = property;</b>
<b class="nc">&nbsp;            this.updateA = updateA;</b>
<b class="nc">&nbsp;            this.updateB = updateB;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void changed(ObservableValue&lt;? extends B&gt; observable, B oldValue, B newValue) {
<b class="nc">&nbsp;            if (!updating) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    updating = true;</b>
<b class="nc">&nbsp;                    updateA.accept(newValue);</b>
&nbsp;                } finally {
<b class="nc">&nbsp;                    updating = false;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void onChanged(Change&lt;? extends A&gt; c) {
<b class="nc">&nbsp;            if (!updating) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    updating = true;</b>
<b class="nc">&nbsp;                    updateB.accept(listProperty);</b>
&nbsp;                } finally {
<b class="nc">&nbsp;                    updating = false;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private static class BidirectionalMapBinding&lt;A, V, B&gt; implements MapChangeListener&lt;A, V&gt;, ChangeListener&lt;B&gt; {
&nbsp;
&nbsp;        private final ObservableMap&lt;A, V&gt; mapProperty;
&nbsp;        private final ObservableValue&lt;B&gt; property;
&nbsp;        private final Consumer&lt;B&gt; updateA;
&nbsp;        private final Consumer&lt;Map&lt;A, V&gt;&gt; updateB;
<b class="nc">&nbsp;        private boolean updating = false;</b>
&nbsp;
<b class="nc">&nbsp;        public BidirectionalMapBinding(ObservableMap&lt;A, V&gt; mapProperty, ObservableValue&lt;B&gt; property, Consumer&lt;B&gt; updateA, Consumer&lt;Map&lt;A, V&gt;&gt; updateB) {</b>
<b class="nc">&nbsp;            this.mapProperty = mapProperty;</b>
<b class="nc">&nbsp;            this.property = property;</b>
<b class="nc">&nbsp;            this.updateA = updateA;</b>
<b class="nc">&nbsp;            this.updateB = updateB;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void changed(ObservableValue&lt;? extends B&gt; observable, B oldValue, B newValue) {
<b class="nc">&nbsp;            if (!updating) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    updating = true;</b>
<b class="nc">&nbsp;                    updateA.accept(newValue);</b>
&nbsp;                } finally {
<b class="nc">&nbsp;                    updating = false;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void onChanged(Change&lt;? extends A, ? extends V&gt; c) {
<b class="nc">&nbsp;            if (!updating) {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    updating = true;</b>
<b class="nc">&nbsp;                    updateB.accept(mapProperty);</b>
&nbsp;                } finally {
<b class="nc">&nbsp;                    updating = false;</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-09-29 22:51</div>
</div>
</body>
</html>

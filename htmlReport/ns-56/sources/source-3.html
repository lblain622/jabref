


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > FieldValueCell</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.jabref.gui.mergeentries.threewaymerge.cell</a>
</div>

<h1>Coverage Summary for Class: FieldValueCell (org.jabref.gui.mergeentries.threewaymerge.cell)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">FieldValueCell</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/21)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/78)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.jabref.gui.mergeentries.threewaymerge.cell;
&nbsp;
&nbsp;import javafx.beans.property.BooleanProperty;
&nbsp;import javafx.beans.property.ObjectProperty;
&nbsp;import javafx.css.PseudoClass;
&nbsp;import javafx.geometry.Insets;
&nbsp;import javafx.geometry.Pos;
&nbsp;import javafx.scene.Cursor;
&nbsp;import javafx.scene.Node;
&nbsp;import javafx.scene.control.Button;
&nbsp;import javafx.scene.control.ContentDisplay;
&nbsp;import javafx.scene.control.ScrollPane;
&nbsp;import javafx.scene.control.Toggle;
&nbsp;import javafx.scene.control.ToggleGroup;
&nbsp;import javafx.scene.input.MouseEvent;
&nbsp;import javafx.scene.input.ScrollEvent;
&nbsp;import javafx.scene.layout.Background;
&nbsp;import javafx.scene.layout.HBox;
&nbsp;import javafx.scene.layout.Priority;
&nbsp;import javafx.scene.paint.Color;
&nbsp;
&nbsp;import org.jabref.gui.actions.ActionFactory;
&nbsp;import org.jabref.gui.icon.IconTheme;
&nbsp;import org.jabref.gui.preferences.GuiPreferences;
&nbsp;import org.jabref.logic.l10n.Localization;
&nbsp;import org.jabref.logic.util.URLUtil;
&nbsp;import org.jabref.model.entry.identifier.DOI;
&nbsp;import org.jabref.model.strings.StringUtil;
&nbsp;
&nbsp;import com.tobiasdiez.easybind.EasyBind;
&nbsp;import org.fxmisc.flowless.VirtualizedScrollPane;
&nbsp;import org.fxmisc.richtext.StyleClassedTextArea;
&nbsp;import org.kordamp.ikonli.javafx.FontIcon;
&nbsp;import org.kordamp.ikonli.materialdesign2.MaterialDesignC;
&nbsp;import org.slf4j.Logger;
&nbsp;import org.slf4j.LoggerFactory;
&nbsp;
&nbsp;/**
&nbsp; * A readonly, selectable field cell that contains the value of some field
&nbsp; */
&nbsp;public class FieldValueCell extends ThreeWayMergeCell implements Toggle {
<b class="nc">&nbsp;    public static final Logger LOGGER = LoggerFactory.getLogger(FieldValueCell.class);</b>
&nbsp;
&nbsp;    public static final String DEFAULT_STYLE_CLASS = &quot;merge-field-value&quot;;
&nbsp;    public static final String SELECTION_BOX_STYLE_CLASS = &quot;selection-box&quot;;
&nbsp;
<b class="nc">&nbsp;    private static final PseudoClass SELECTED_PSEUDO_CLASS = PseudoClass.getPseudoClass(&quot;selected&quot;);</b>
&nbsp;
&nbsp;    private final GuiPreferences preferences;
&nbsp;
&nbsp;    private final ActionFactory factory;
&nbsp;
<b class="nc">&nbsp;    private final StyleClassedTextArea label = new StyleClassedTextArea();</b>
<b class="nc">&nbsp;    private final VirtualizedScrollPane&lt;StyleClassedTextArea&gt; scrollPane = new VirtualizedScrollPane&lt;&gt;(label);</b>
<b class="nc">&nbsp;    HBox labelBox = new HBox(scrollPane);</b>
&nbsp;
<b class="nc">&nbsp;    private final HBox selectionBox = new HBox();</b>
<b class="nc">&nbsp;    private final HBox actionsContainer = new HBox();</b>
&nbsp;    private final FieldValueCellViewModel viewModel;
&nbsp;
&nbsp;    public FieldValueCell(String text, int rowIndex, GuiPreferences preferences) {
<b class="nc">&nbsp;        super(text, rowIndex);</b>
&nbsp;
<b class="nc">&nbsp;        this.preferences = preferences;</b>
<b class="nc">&nbsp;        this.factory = new ActionFactory();</b>
<b class="nc">&nbsp;        this.viewModel = new FieldValueCellViewModel(text);</b>
&nbsp;
<b class="nc">&nbsp;        EasyBind.listen(viewModel.selectedProperty(), (observable, old, isSelected) -&gt; {</b>
<b class="nc">&nbsp;            pseudoClassStateChanged(SELECTED_PSEUDO_CLASS, isSelected);</b>
<b class="nc">&nbsp;            getToggleGroup().selectToggle(FieldValueCell.this);</b>
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        viewModel.fieldValueProperty().bind(textProperty());</b>
&nbsp;
<b class="nc">&nbsp;        initialize();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void initialize() {
<b class="nc">&nbsp;        getStyleClass().add(DEFAULT_STYLE_CLASS);</b>
<b class="nc">&nbsp;        initializeScrollPane();</b>
<b class="nc">&nbsp;        initializeLabel();</b>
<b class="nc">&nbsp;        initializeSelectionBox();</b>
<b class="nc">&nbsp;        initializeActions();</b>
<b class="nc">&nbsp;        setOnMouseClicked(e -&gt; {</b>
<b class="nc">&nbsp;            if (!isDisabled()) {</b>
<b class="nc">&nbsp;                setSelected(true);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        selectionBox.getChildren().addAll(labelBox, actionsContainer);</b>
<b class="nc">&nbsp;        getChildren().setAll(selectionBox);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void initializeLabel() {
<b class="nc">&nbsp;        label.setEditable(false);</b>
<b class="nc">&nbsp;        label.setBackground(Background.fill(Color.TRANSPARENT));</b>
<b class="nc">&nbsp;        EasyBind.subscribe(textProperty(), label::replaceText);</b>
<b class="nc">&nbsp;        label.setAutoHeight(true);</b>
<b class="nc">&nbsp;        label.setWrapText(true);</b>
<b class="nc">&nbsp;        label.setStyle(&quot;-fx-cursor: hand&quot;);</b>
&nbsp;
&nbsp;        // Workarounds
<b class="nc">&nbsp;        preventTextSelectionViaMouseEvents();</b>
&nbsp;
<b class="nc">&nbsp;        label.prefHeightProperty().bind(label.totalHeightEstimateProperty().orElseConst(-1d));</b>
&nbsp;
&nbsp;        // Fix text area consuming scroll events before they reach the outer scrollable
<b class="nc">&nbsp;        label.addEventFilter(ScrollEvent.SCROLL, e -&gt; {</b>
<b class="nc">&nbsp;            e.consume();</b>
<b class="nc">&nbsp;            FieldValueCell.this.fireEvent(e.copyFor(e.getSource(), FieldValueCell.this));</b>
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    private void initializeActions() {
<b class="nc">&nbsp;        actionsContainer.getChildren().setAll(createOpenLinkButton(), createCopyButton());</b>
<b class="nc">&nbsp;        actionsContainer.setAlignment(Pos.TOP_CENTER);</b>
<b class="nc">&nbsp;        actionsContainer.setPrefWidth(28);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void initializeSelectionBox() {
<b class="nc">&nbsp;        selectionBox.getStyleClass().add(SELECTION_BOX_STYLE_CLASS);</b>
<b class="nc">&nbsp;        HBox.setHgrow(selectionBox, Priority.ALWAYS);</b>
&nbsp;
<b class="nc">&nbsp;        HBox.setHgrow(labelBox, Priority.ALWAYS);</b>
<b class="nc">&nbsp;        labelBox.setPadding(new Insets(8));</b>
<b class="nc">&nbsp;        labelBox.setCursor(Cursor.HAND);</b>
&nbsp;    }
&nbsp;
&nbsp;    private Button createCopyButton() {
<b class="nc">&nbsp;        FontIcon copyIcon = FontIcon.of(MaterialDesignC.CONTENT_COPY);</b>
<b class="nc">&nbsp;        copyIcon.getStyleClass().add(&quot;action-icon&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        Button copyButton = factory.createIconButton(() -&gt; Localization.lang(&quot;Copy&quot;), new CopyFieldValueCommand(getText()));</b>
<b class="nc">&nbsp;        copyButton.setGraphic(copyIcon);</b>
<b class="nc">&nbsp;        copyButton.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);</b>
<b class="nc">&nbsp;        copyButton.setMaxHeight(Double.MAX_VALUE);</b>
<b class="nc">&nbsp;        copyButton.visibleProperty().bind(textProperty().isEmpty().not());</b>
&nbsp;
<b class="nc">&nbsp;        return copyButton;</b>
&nbsp;    }
&nbsp;
&nbsp;    public Button createOpenLinkButton() {
<b class="nc">&nbsp;        Node openLinkIcon = IconTheme.JabRefIcons.OPEN_LINK.getGraphicNode();</b>
<b class="nc">&nbsp;        openLinkIcon.getStyleClass().add(&quot;action-icon&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        Button openLinkButton = factory.createIconButton(() -&gt; Localization.lang(&quot;Open Link&quot;), new OpenExternalLinkAction(getText(), preferences.getExternalApplicationsPreferences()));</b>
<b class="nc">&nbsp;        openLinkButton.setGraphic(openLinkIcon);</b>
<b class="nc">&nbsp;        openLinkButton.setContentDisplay(ContentDisplay.GRAPHIC_ONLY);</b>
<b class="nc">&nbsp;        openLinkButton.setMaxHeight(Double.MAX_VALUE);</b>
&nbsp;
<b class="nc">&nbsp;        openLinkButton.visibleProperty().bind(EasyBind.map(textProperty(), input -&gt; StringUtil.isNotBlank(input) &amp;&amp; (URLUtil.isURL(input) || DOI.isValid(input))));</b>
&nbsp;
<b class="nc">&nbsp;        return openLinkButton;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void initializeScrollPane() {
<b class="nc">&nbsp;        HBox.setHgrow(scrollPane, Priority.ALWAYS);</b>
<b class="nc">&nbsp;        scrollPane.setVbarPolicy(ScrollPane.ScrollBarPolicy.NEVER);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void preventTextSelectionViaMouseEvents() {
<b class="nc">&nbsp;        label.addEventFilter(MouseEvent.ANY, e -&gt; {</b>
<b class="nc">&nbsp;            if ((e.getEventType() == MouseEvent.MOUSE_DRAGGED) ||</b>
<b class="nc">&nbsp;                    (e.getEventType() == MouseEvent.DRAG_DETECTED) ||</b>
<b class="nc">&nbsp;                    (e.getEventType() == MouseEvent.MOUSE_ENTERED)) {</b>
<b class="nc">&nbsp;                e.consume();</b>
<b class="nc">&nbsp;            } else if (e.getEventType() == MouseEvent.MOUSE_PRESSED) {</b>
<b class="nc">&nbsp;                if (e.getClickCount() &gt; 1) {</b>
<b class="nc">&nbsp;                    e.consume();</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public ToggleGroup getToggleGroup() {
<b class="nc">&nbsp;        return viewModel.getToggleGroup();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void setToggleGroup(ToggleGroup toggleGroup) {
<b class="nc">&nbsp;        viewModel.setToggleGroup(toggleGroup);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public ObjectProperty&lt;ToggleGroup&gt; toggleGroupProperty() {
<b class="nc">&nbsp;        return viewModel.toggleGroupProperty();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isSelected() {
<b class="nc">&nbsp;        return viewModel.isSelected();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void setSelected(boolean selected) {
<b class="nc">&nbsp;        viewModel.setSelected(selected);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public BooleanProperty selectedProperty() {
<b class="nc">&nbsp;        return viewModel.selectedProperty();</b>
&nbsp;    }
&nbsp;
&nbsp;    public StyleClassedTextArea getStyleClassedLabel() {
<b class="nc">&nbsp;        return label;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-09-29 22:51</div>
</div>
</body>
</html>




<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > WebSearchTabViewModel</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.jabref.gui.preferences.websearch</a>
</div>

<h1>Coverage Summary for Class: WebSearchTabViewModel (org.jabref.gui.preferences.websearch)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">WebSearchTabViewModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/26)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/34)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/142)
  </span>
</td>
</tr>
  <tr>
    <td class="name">WebSearchTabViewModel$FetcherViewModel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/21)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/34)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/163)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.jabref.gui.preferences.websearch;
&nbsp;
&nbsp;import java.io.IOException;
&nbsp;import java.net.HttpURLConnection;
&nbsp;import java.util.Comparator;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.List;
&nbsp;import java.util.Set;
&nbsp;import java.util.concurrent.Callable;
&nbsp;import java.util.function.Consumer;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import javafx.beans.property.BooleanProperty;
&nbsp;import javafx.beans.property.IntegerProperty;
&nbsp;import javafx.beans.property.ListProperty;
&nbsp;import javafx.beans.property.ObjectProperty;
&nbsp;import javafx.beans.property.ReadOnlyBooleanProperty;
&nbsp;import javafx.beans.property.SimpleBooleanProperty;
&nbsp;import javafx.beans.property.SimpleIntegerProperty;
&nbsp;import javafx.beans.property.SimpleListProperty;
&nbsp;import javafx.beans.property.SimpleObjectProperty;
&nbsp;import javafx.beans.property.SimpleStringProperty;
&nbsp;import javafx.beans.property.StringProperty;
&nbsp;import javafx.collections.FXCollections;
&nbsp;import javafx.collections.ObservableList;
&nbsp;
&nbsp;import org.jabref.gui.preferences.PreferenceTabViewModel;
&nbsp;import org.jabref.logic.FilePreferences;
&nbsp;import org.jabref.logic.LibraryPreferences;
&nbsp;import org.jabref.logic.importer.ImportFormatPreferences;
&nbsp;import org.jabref.logic.importer.ImporterPreferences;
&nbsp;import org.jabref.logic.importer.SearchBasedFetcher;
&nbsp;import org.jabref.logic.importer.WebFetcher;
&nbsp;import org.jabref.logic.importer.WebFetchers;
&nbsp;import org.jabref.logic.importer.fetcher.CompositeSearchBasedFetcher;
&nbsp;import org.jabref.logic.importer.fetcher.CustomizableKeyFetcher;
&nbsp;import org.jabref.logic.importer.plaincitation.PlainCitationParserChoice;
&nbsp;import org.jabref.logic.importer.util.GrobidPreferences;
&nbsp;import org.jabref.logic.l10n.Localization;
&nbsp;import org.jabref.logic.net.URLDownload;
&nbsp;import org.jabref.logic.os.OS;
&nbsp;import org.jabref.logic.preferences.CliPreferences;
&nbsp;import org.jabref.logic.preferences.DOIPreferences;
&nbsp;import org.jabref.logic.preferences.FetcherApiKey;
&nbsp;import org.jabref.logic.util.BackgroundTask;
&nbsp;import org.jabref.logic.util.TaskExecutor;
&nbsp;
&nbsp;import kong.unirest.core.UnirestException;
&nbsp;
&nbsp;public class WebSearchTabViewModel implements PreferenceTabViewModel {
<b class="nc">&nbsp;    private final BooleanProperty enableWebSearchProperty = new SimpleBooleanProperty();</b>
<b class="nc">&nbsp;    private final BooleanProperty warnAboutDuplicatesOnImportProperty = new SimpleBooleanProperty();</b>
<b class="nc">&nbsp;    private final BooleanProperty shouldDownloadLinkedOnlineFiles = new SimpleBooleanProperty();</b>
<b class="nc">&nbsp;    private final BooleanProperty shouldkeepDownloadUrl = new SimpleBooleanProperty();</b>
&nbsp;
<b class="nc">&nbsp;    private final ListProperty&lt;PlainCitationParserChoice&gt; plainCitationParsers =</b>
<b class="nc">&nbsp;            new SimpleListProperty&lt;&gt;(FXCollections.observableArrayList(PlainCitationParserChoice.values()));</b>
<b class="nc">&nbsp;    private final ObjectProperty&lt;PlainCitationParserChoice&gt; defaultPlainCitationParser = new SimpleObjectProperty&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;    private final IntegerProperty citationsRelationStoreTTL = new SimpleIntegerProperty();</b>
&nbsp;
<b class="nc">&nbsp;    private final BooleanProperty addImportedEntries = new SimpleBooleanProperty();</b>
<b class="nc">&nbsp;    private final StringProperty addImportedEntriesGroupName = new SimpleStringProperty(&quot;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;    private final BooleanProperty useCustomDOIProperty = new SimpleBooleanProperty();</b>
<b class="nc">&nbsp;    private final StringProperty useCustomDOINameProperty = new SimpleStringProperty(&quot;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;    private final ObservableList&lt;FetcherViewModel&gt; fetchers = FXCollections.observableArrayList();</b>
<b class="nc">&nbsp;    private final BooleanProperty grobidEnabledProperty = new SimpleBooleanProperty();</b>
<b class="nc">&nbsp;    private final StringProperty grobidURLProperty = new SimpleStringProperty(&quot;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;    private final BooleanProperty apikeyPersistProperty = new SimpleBooleanProperty();</b>
<b class="nc">&nbsp;    private final BooleanProperty apikeyPersistAvailableProperty = new SimpleBooleanProperty();</b>
&nbsp;
&nbsp;    private final CliPreferences preferences;
&nbsp;    private final DOIPreferences doiPreferences;
&nbsp;    private final GrobidPreferences grobidPreferences;
&nbsp;    private final ImporterPreferences importerPreferences;
&nbsp;    private final FilePreferences filePreferences;
&nbsp;    private final ImportFormatPreferences importFormatPreferences;
&nbsp;    private final LibraryPreferences libraryPreferences;
&nbsp;    private final TaskExecutor taskExecutor;
&nbsp;
&nbsp;    private final ReadOnlyBooleanProperty refAiEnabled;
&nbsp;
<b class="nc">&nbsp;    public WebSearchTabViewModel(CliPreferences preferences, ReadOnlyBooleanProperty refAiEnabled, TaskExecutor taskExecutor) {</b>
<b class="nc">&nbsp;        this.preferences = preferences;</b>
<b class="nc">&nbsp;        this.importerPreferences = preferences.getImporterPreferences();</b>
<b class="nc">&nbsp;        this.grobidPreferences = preferences.getGrobidPreferences();</b>
<b class="nc">&nbsp;        this.doiPreferences = preferences.getDOIPreferences();</b>
<b class="nc">&nbsp;        this.filePreferences = preferences.getFilePreferences();</b>
<b class="nc">&nbsp;        this.importFormatPreferences = preferences.getImportFormatPreferences();</b>
<b class="nc">&nbsp;        this.libraryPreferences = preferences.getLibraryPreferences();</b>
<b class="nc">&nbsp;        this.taskExecutor = taskExecutor;</b>
&nbsp;
<b class="nc">&nbsp;        this.refAiEnabled = refAiEnabled;</b>
&nbsp;
<b class="nc">&nbsp;        setupPlainCitationParsers(preferences);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void setupPlainCitationParsers(CliPreferences preferences) {
<b class="nc">&nbsp;        if (!refAiEnabled.get()) {</b>
<b class="nc">&nbsp;            plainCitationParsers.remove(PlainCitationParserChoice.LLM);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        refAiEnabled.addListener((observable, oldValue, newValue) -&gt; {</b>
<b class="nc">&nbsp;            if (newValue) {</b>
<b class="nc">&nbsp;                plainCitationParsers.add(PlainCitationParserChoice.LLM);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                PlainCitationParserChoice oldChoice = defaultPlainCitationParser.get();</b>
&nbsp;
<b class="nc">&nbsp;                plainCitationParsers.remove(PlainCitationParserChoice.LLM);</b>
&nbsp;
<b class="nc">&nbsp;                if (oldChoice == PlainCitationParserChoice.LLM) {</b>
<b class="nc">&nbsp;                    defaultPlainCitationParser.set(plainCitationParsers.getFirst());</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        if (!grobidEnabledProperty().get()) {</b>
<b class="nc">&nbsp;            plainCitationParsers.remove(PlainCitationParserChoice.GROBID);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        grobidEnabledProperty.addListener((observable, oldValue, newValue) -&gt; {</b>
<b class="nc">&nbsp;            if (newValue) {</b>
<b class="nc">&nbsp;                plainCitationParsers.add(PlainCitationParserChoice.GROBID);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                PlainCitationParserChoice oldChoice = defaultPlainCitationParser.get();</b>
&nbsp;
<b class="nc">&nbsp;                plainCitationParsers.remove(PlainCitationParserChoice.GROBID);</b>
&nbsp;
<b class="nc">&nbsp;                if (oldChoice == PlainCitationParserChoice.GROBID) {</b>
<b class="nc">&nbsp;                    defaultPlainCitationParser.set(plainCitationParsers.getFirst());</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void setValues() {
<b class="nc">&nbsp;        enableWebSearchProperty.setValue(importerPreferences.areImporterEnabled());</b>
<b class="nc">&nbsp;        warnAboutDuplicatesOnImportProperty.setValue(importerPreferences.shouldWarnAboutDuplicatesOnImport());</b>
<b class="nc">&nbsp;        shouldDownloadLinkedOnlineFiles.setValue(filePreferences.shouldDownloadLinkedFiles());</b>
<b class="nc">&nbsp;        shouldkeepDownloadUrl.setValue(filePreferences.shouldKeepDownloadUrl());</b>
<b class="nc">&nbsp;        addImportedEntries.setValue(libraryPreferences.isAddImportedEntriesEnabled());</b>
<b class="nc">&nbsp;        addImportedEntriesGroupName.setValue(libraryPreferences.getAddImportedEntriesGroupName());</b>
<b class="nc">&nbsp;        defaultPlainCitationParser.setValue(importerPreferences.getDefaultPlainCitationParser());</b>
<b class="nc">&nbsp;        citationsRelationStoreTTL.setValue(importerPreferences.getCitationsRelationsStoreTTL());</b>
&nbsp;
<b class="nc">&nbsp;        useCustomDOIProperty.setValue(doiPreferences.isUseCustom());</b>
<b class="nc">&nbsp;        useCustomDOINameProperty.setValue(doiPreferences.getDefaultBaseURI());</b>
&nbsp;
<b class="nc">&nbsp;        grobidEnabledProperty.setValue(grobidPreferences.isGrobidEnabled());</b>
<b class="nc">&nbsp;        grobidURLProperty.setValue(grobidPreferences.getGrobidURL());</b>
&nbsp;
<b class="nc">&nbsp;        Set&lt;FetcherApiKey&gt; savedApiKeys = preferences.getImporterPreferences().getApiKeys();</b>
<b class="nc">&nbsp;        Set&lt;String&gt; enabledCatalogs = new HashSet&lt;&gt;(importerPreferences.getCatalogs());</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;SearchBasedFetcher&gt; allFetchers = WebFetchers.getSearchBasedFetchers(importFormatPreferences, importerPreferences)</b>
<b class="nc">&nbsp;                                                          .stream().sorted(Comparator.comparing(WebFetcher::getName)).toList();</b>
&nbsp;
<b class="nc">&nbsp;        Set&lt;CustomizableKeyFetcher&gt; customizableKeyFetchers = WebFetchers.getCustomizableKeyFetchers(importFormatPreferences, importerPreferences);</b>
<b class="nc">&nbsp;        Set&lt;String&gt; customizableFetcherNames = customizableKeyFetchers.stream().map(WebFetcher::getName).collect(Collectors.toSet());</b>
&nbsp;
<b class="nc">&nbsp;        fetchers.clear();</b>
<b class="nc">&nbsp;        for (SearchBasedFetcher fetcher : allFetchers) {</b>
<b class="nc">&nbsp;            if (CompositeSearchBasedFetcher.FETCHER_NAME.equals(fetcher.getName())) {</b>
&nbsp;                continue;
&nbsp;            }
<b class="nc">&nbsp;            boolean isEnabled = enabledCatalogs.contains(fetcher.getName());</b>
<b class="nc">&nbsp;            boolean isCustomizable = customizableFetcherNames.contains(fetcher.getName());</b>
<b class="nc">&nbsp;            FetcherViewModel fetcherViewModel = new FetcherViewModel(fetcher, isEnabled, isCustomizable);</b>
<b class="nc">&nbsp;            if (isCustomizable) {</b>
<b class="nc">&nbsp;                savedApiKeys.stream()</b>
<b class="nc">&nbsp;                            .filter(apiKey -&gt; apiKey.getName().equals(fetcher.getName()))</b>
<b class="nc">&nbsp;                            .findFirst()</b>
<b class="nc">&nbsp;                            .ifPresent(apiKey -&gt; {</b>
<b class="nc">&nbsp;                                fetcherViewModel.apiKeyProperty().set(apiKey.getKey());</b>
<b class="nc">&nbsp;                                fetcherViewModel.useCustomApiKeyProperty().set(apiKey.shouldUse());</b>
&nbsp;                            });
&nbsp;            }
<b class="nc">&nbsp;            fetchers.add(fetcherViewModel);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        apikeyPersistAvailableProperty.setValue(OS.isKeyringAvailable());</b>
<b class="nc">&nbsp;        apikeyPersistProperty.setValue(preferences.getImporterPreferences().shouldPersistCustomKeys());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void storeSettings() {
<b class="nc">&nbsp;        importerPreferences.setImporterEnabled(enableWebSearchProperty.getValue());</b>
<b class="nc">&nbsp;        importerPreferences.setWarnAboutDuplicatesOnImport(warnAboutDuplicatesOnImportProperty.getValue());</b>
<b class="nc">&nbsp;        filePreferences.setDownloadLinkedFiles(shouldDownloadLinkedOnlineFiles.getValue());</b>
<b class="nc">&nbsp;        filePreferences.setKeepDownloadUrl(shouldkeepDownloadUrl.getValue());</b>
<b class="nc">&nbsp;        libraryPreferences.setAddImportedEntries(addImportedEntries.getValue());</b>
<b class="nc">&nbsp;        if (addImportedEntriesGroupName.getValue().isEmpty() || addImportedEntriesGroupName.getValue().startsWith(&quot; &quot;)) {</b>
<b class="nc">&nbsp;            libraryPreferences.setAddImportedEntriesGroupName(Localization.lang(&quot;Imported entries&quot;));</b>
&nbsp;        } else {
<b class="nc">&nbsp;            libraryPreferences.setAddImportedEntriesGroupName(addImportedEntriesGroupName.getValue());</b>
&nbsp;        }
<b class="nc">&nbsp;        importerPreferences.setDefaultPlainCitationParser(defaultPlainCitationParser.getValue());</b>
<b class="nc">&nbsp;        importerPreferences.setCitationsRelationsStoreTTL(citationsRelationStoreTTL.getValue());</b>
&nbsp;
<b class="nc">&nbsp;        grobidPreferences.setGrobidEnabled(grobidEnabledProperty.getValue());</b>
<b class="nc">&nbsp;        grobidPreferences.setGrobidUseAsked(grobidPreferences.isGrobidUseAsked());</b>
<b class="nc">&nbsp;        grobidPreferences.setGrobidURL(grobidURLProperty.getValue());</b>
<b class="nc">&nbsp;        doiPreferences.setUseCustom(useCustomDOIProperty.get());</b>
<b class="nc">&nbsp;        doiPreferences.setDefaultBaseURI(useCustomDOINameProperty.getValue().trim());</b>
&nbsp;
<b class="nc">&nbsp;        importerPreferences.setCatalogs(</b>
<b class="nc">&nbsp;                fetchers.stream()</b>
<b class="nc">&nbsp;                        .filter(FetcherViewModel::isEnabled)</b>
<b class="nc">&nbsp;                        .map(FetcherViewModel::getName)</b>
<b class="nc">&nbsp;                        .toList());</b>
&nbsp;
<b class="nc">&nbsp;        List&lt;FetcherApiKey&gt; apiKeysToStore = fetchers.stream()</b>
<b class="nc">&nbsp;                                                     .filter(FetcherViewModel::isCustomizable)</b>
<b class="nc">&nbsp;                                                     .map(fetcherViewModel -&gt; new FetcherApiKey(fetcherViewModel.getName(), fetcherViewModel.shouldUseCustomApiKey(), fetcherViewModel.getApiKey()))</b>
<b class="nc">&nbsp;                                                     .toList();</b>
&nbsp;
<b class="nc">&nbsp;        importerPreferences.setPersistCustomKeys(apikeyPersistProperty.get());</b>
<b class="nc">&nbsp;        preferences.getImporterPreferences().getApiKeys().clear();</b>
<b class="nc">&nbsp;        if (apikeyPersistAvailableProperty.get()) {</b>
<b class="nc">&nbsp;            preferences.getImporterPreferences().getApiKeys().addAll(apiKeysToStore);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public BooleanProperty enableWebSearchProperty() {
<b class="nc">&nbsp;        return enableWebSearchProperty;</b>
&nbsp;    }
&nbsp;
&nbsp;    public ListProperty&lt;PlainCitationParserChoice&gt; plainCitationParsers() {
<b class="nc">&nbsp;        return plainCitationParsers;</b>
&nbsp;    }
&nbsp;
&nbsp;    public ObjectProperty&lt;PlainCitationParserChoice&gt; defaultPlainCitationParserProperty() {
<b class="nc">&nbsp;        return defaultPlainCitationParser;</b>
&nbsp;    }
&nbsp;
&nbsp;    public BooleanProperty getAddImportedEntries() {
<b class="nc">&nbsp;        return addImportedEntries;</b>
&nbsp;    }
&nbsp;
&nbsp;    public StringProperty getAddImportedEntriesGroupName() {
<b class="nc">&nbsp;        return addImportedEntriesGroupName;</b>
&nbsp;    }
&nbsp;
&nbsp;    public BooleanProperty useCustomDOIProperty() {
<b class="nc">&nbsp;        return this.useCustomDOIProperty;</b>
&nbsp;    }
&nbsp;
&nbsp;    public StringProperty useCustomDOINameProperty() {
<b class="nc">&nbsp;        return this.useCustomDOINameProperty;</b>
&nbsp;    }
&nbsp;
&nbsp;    public ObservableList&lt;FetcherViewModel&gt; getFetchers() {
<b class="nc">&nbsp;        return fetchers;</b>
&nbsp;    }
&nbsp;
&nbsp;    public BooleanProperty grobidEnabledProperty() {
<b class="nc">&nbsp;        return grobidEnabledProperty;</b>
&nbsp;    }
&nbsp;
&nbsp;    public StringProperty grobidURLProperty() {
<b class="nc">&nbsp;        return grobidURLProperty;</b>
&nbsp;    }
&nbsp;
&nbsp;    public BooleanProperty warnAboutDuplicatesOnImportProperty() {
<b class="nc">&nbsp;        return warnAboutDuplicatesOnImportProperty;</b>
&nbsp;    }
&nbsp;
&nbsp;    public BooleanProperty shouldDownloadLinkedOnlineFiles() {
<b class="nc">&nbsp;        return shouldDownloadLinkedOnlineFiles;</b>
&nbsp;    }
&nbsp;
&nbsp;    public BooleanProperty shouldKeepDownloadUrl() {
<b class="nc">&nbsp;        return shouldkeepDownloadUrl;</b>
&nbsp;    }
&nbsp;
&nbsp;    public ReadOnlyBooleanProperty apiKeyPersistAvailable() {
<b class="nc">&nbsp;        return apikeyPersistAvailableProperty;</b>
&nbsp;    }
&nbsp;
&nbsp;    public BooleanProperty getApikeyPersistProperty() {
<b class="nc">&nbsp;        return apikeyPersistProperty;</b>
&nbsp;    }
&nbsp;
&nbsp;    public IntegerProperty citationsRelationsStoreTTLProperty() {
<b class="nc">&nbsp;        return citationsRelationStoreTTL;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void checkApiKey(FetcherViewModel fetcherViewModel, String apiKey, Consumer&lt;Boolean&gt; onFinished) {
<b class="nc">&nbsp;        Callable&lt;Boolean&gt; tester = () -&gt; {</b>
<b class="nc">&nbsp;            WebFetcher webFetcher = fetcherViewModel.getFetcher();</b>
&nbsp;
<b class="nc">&nbsp;            if (!(webFetcher instanceof CustomizableKeyFetcher fetcher)) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            String testUrlWithoutApiKey = fetcher.getTestUrl();</b>
<b class="nc">&nbsp;            if (testUrlWithoutApiKey == null) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            if (apiKey.isEmpty()) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;
&nbsp;            try {
<b class="nc">&nbsp;                URLDownload urlDownload = new URLDownload(testUrlWithoutApiKey + apiKey);</b>
&nbsp;                // The HEAD request cannot be used because its response is not 200 (maybe 404 or 596...).
<b class="nc">&nbsp;                int statusCode = ((HttpURLConnection) urlDownload.getSource().openConnection()).getResponseCode();</b>
<b class="nc">&nbsp;                return (statusCode &gt;= 200) &amp;&amp; (statusCode &lt; 300);</b>
&nbsp;            } catch (IOException | UnirestException e) {
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        };
<b class="nc">&nbsp;        BackgroundTask.wrap(tester)</b>
<b class="nc">&nbsp;                      .onSuccess(onFinished)</b>
<b class="nc">&nbsp;                      .onFailure(_ -&gt; onFinished.accept(false))</b>
<b class="nc">&nbsp;                      .executeWith(taskExecutor);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean validateSettings() {
<b class="nc">&nbsp;        return getFetchers().stream().anyMatch(FetcherViewModel::isEnabled);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static class FetcherViewModel {
<b class="nc">&nbsp;        private final StringProperty name = new SimpleStringProperty();</b>
<b class="nc">&nbsp;        private final BooleanProperty enabled = new SimpleBooleanProperty();</b>
<b class="nc">&nbsp;        private final BooleanProperty customizable = new SimpleBooleanProperty();</b>
<b class="nc">&nbsp;        private final StringProperty apiKey = new SimpleStringProperty(&quot;&quot;);</b>
<b class="nc">&nbsp;        private final BooleanProperty useCustomApiKey = new SimpleBooleanProperty(false);</b>
&nbsp;        private final WebFetcher fetcher;
&nbsp;
<b class="nc">&nbsp;        public FetcherViewModel(WebFetcher fetcher, boolean enabled, boolean customizable) {</b>
<b class="nc">&nbsp;            this.name.set(fetcher.getName());</b>
<b class="nc">&nbsp;            this.fetcher = fetcher;</b>
<b class="nc">&nbsp;            this.enabled.set(enabled);</b>
<b class="nc">&nbsp;            this.customizable.set(customizable);</b>
&nbsp;        }
&nbsp;
&nbsp;        public String getName() {
<b class="nc">&nbsp;            return name.get();</b>
&nbsp;        }
&nbsp;
&nbsp;        public StringProperty nameProperty() {
<b class="nc">&nbsp;            return name;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean isEnabled() {
<b class="nc">&nbsp;            return enabled.get();</b>
&nbsp;        }
&nbsp;
&nbsp;        public BooleanProperty enabledProperty() {
<b class="nc">&nbsp;            return enabled;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean isCustomizable() {
<b class="nc">&nbsp;            return customizable.get();</b>
&nbsp;        }
&nbsp;
&nbsp;        public BooleanProperty customizableProperty() {
<b class="nc">&nbsp;            return customizable;</b>
&nbsp;        }
&nbsp;
&nbsp;        public String getApiKey() {
<b class="nc">&nbsp;            return apiKey.get();</b>
&nbsp;        }
&nbsp;
&nbsp;        public StringProperty apiKeyProperty() {
<b class="nc">&nbsp;            return apiKey;</b>
&nbsp;        }
&nbsp;
&nbsp;        public boolean shouldUseCustomApiKey() {
<b class="nc">&nbsp;            return useCustomApiKey.get();</b>
&nbsp;        }
&nbsp;
&nbsp;        public BooleanProperty useCustomApiKeyProperty() {
<b class="nc">&nbsp;            return useCustomApiKey;</b>
&nbsp;        }
&nbsp;
&nbsp;        public WebFetcher getFetcher() {
<b class="nc">&nbsp;            return fetcher;</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-09-29 22:51</div>
</div>
</body>
</html>




<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > ThreeWayMergeView</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.jabref.gui.mergeentries.threewaymerge</a>
</div>

<h1>Coverage Summary for Class: ThreeWayMergeView (org.jabref.gui.mergeentries.threewaymerge)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ThreeWayMergeView</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/23)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/30)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/90)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.jabref.gui.mergeentries.threewaymerge;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;
&nbsp;import javafx.scene.control.ScrollPane;
&nbsp;import javafx.scene.layout.ColumnConstraints;
&nbsp;import javafx.scene.layout.GridPane;
&nbsp;import javafx.scene.layout.Priority;
&nbsp;import javafx.scene.layout.RowConstraints;
&nbsp;import javafx.scene.layout.VBox;
&nbsp;import javafx.stage.Screen;
&nbsp;
&nbsp;import org.jabref.gui.mergeentries.threewaymerge.fieldsmerger.FieldMergerFactory;
&nbsp;import org.jabref.gui.mergeentries.threewaymerge.toolbar.ThreeWayMergeToolbar;
&nbsp;import org.jabref.gui.preferences.GuiPreferences;
&nbsp;import org.jabref.logic.l10n.Localization;
&nbsp;import org.jabref.model.entry.BibEntry;
&nbsp;import org.jabref.model.entry.field.Field;
&nbsp;import org.jabref.model.entry.field.FieldProperty;
&nbsp;
&nbsp;public class ThreeWayMergeView extends VBox {
&nbsp;    public static final int GRID_COLUMN_MIN_WIDTH = 250;
&nbsp;
<b class="nc">&nbsp;    public static final String LEFT_DEFAULT_HEADER = Localization.lang(&quot;Left Entry&quot;);</b>
<b class="nc">&nbsp;    public static final String RIGHT_DEFAULT_HEADER = Localization.lang(&quot;Right Entry&quot;);</b>
&nbsp;
<b class="nc">&nbsp;    private final ColumnConstraints fieldNameColumnConstraints = new ColumnConstraints(150);</b>
<b class="nc">&nbsp;    private final ColumnConstraints leftEntryColumnConstraints = new ColumnConstraints(GRID_COLUMN_MIN_WIDTH, 256, Double.MAX_VALUE);</b>
<b class="nc">&nbsp;    private final ColumnConstraints rightEntryColumnConstraints = new ColumnConstraints(GRID_COLUMN_MIN_WIDTH, 256, Double.MAX_VALUE);</b>
<b class="nc">&nbsp;    private final ColumnConstraints mergedEntryColumnConstraints = new ColumnConstraints(GRID_COLUMN_MIN_WIDTH, 256, Double.MAX_VALUE);</b>
&nbsp;    private final ThreeWayMergeToolbar toolbar;
&nbsp;    private final ThreeWayMergeHeaderView headerView;
&nbsp;    private final ScrollPane scrollPane;
&nbsp;    private final GridPane mergeGridPane;
&nbsp;
&nbsp;    private final ThreeWayMergeViewModel viewModel;
<b class="nc">&nbsp;    private final List&lt;FieldRowView&gt; fieldRows = new ArrayList&lt;&gt;();</b>
&nbsp;
&nbsp;    private final GuiPreferences preferences;
&nbsp;
&nbsp;    private final FieldMergerFactory fieldMergerFactory;
&nbsp;    private final String keywordSeparator;
&nbsp;
<b class="nc">&nbsp;    public ThreeWayMergeView(BibEntry leftEntry, BibEntry rightEntry, String leftHeader, String rightHeader, GuiPreferences preferences) {</b>
<b class="nc">&nbsp;        this.preferences = preferences;</b>
&nbsp;
<b class="nc">&nbsp;        viewModel = new ThreeWayMergeViewModel(</b>
<b class="nc">&nbsp;                safeClone(leftEntry, rightEntry),</b>
<b class="nc">&nbsp;                safeClone(rightEntry, leftEntry),</b>
&nbsp;                leftHeader,
&nbsp;                rightHeader);
<b class="nc">&nbsp;        this.fieldMergerFactory = new FieldMergerFactory(preferences.getBibEntryPreferences());</b>
<b class="nc">&nbsp;        this.keywordSeparator = preferences.getBibEntryPreferences().getKeywordSeparator().toString();</b>
&nbsp;
<b class="nc">&nbsp;        mergeGridPane = new GridPane();</b>
<b class="nc">&nbsp;        scrollPane = new ScrollPane();</b>
<b class="nc">&nbsp;        headerView = new ThreeWayMergeHeaderView(leftHeader, rightHeader);</b>
<b class="nc">&nbsp;        toolbar = new ThreeWayMergeToolbar();</b>
&nbsp;
<b class="nc">&nbsp;        initializeColumnConstraints();</b>
<b class="nc">&nbsp;        initializeMergeGridPane();</b>
<b class="nc">&nbsp;        initializeScrollPane();</b>
<b class="nc">&nbsp;        initializeHeaderView();</b>
<b class="nc">&nbsp;        initializeToolbar();</b>
&nbsp;
<b class="nc">&nbsp;        this.setPrefHeight(Screen.getPrimary().getBounds().getHeight() * 0.76);</b>
<b class="nc">&nbsp;        this.setPrefWidth(Screen.getPrimary().getBounds().getWidth() * 0.97);</b>
&nbsp;
<b class="nc">&nbsp;        getChildren().addAll(toolbar, headerView, scrollPane);</b>
&nbsp;
<b class="nc">&nbsp;        getStyleClass().add(&quot;three-way-merge&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public ThreeWayMergeView(BibEntry leftEntry, BibEntry rightEntry, GuiPreferences preferences) {
<b class="nc">&nbsp;        this(leftEntry, rightEntry, LEFT_DEFAULT_HEADER, RIGHT_DEFAULT_HEADER, preferences);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void initializeToolbar() {
<b class="nc">&nbsp;        toolbar.setOnSelectLeftEntryValuesButtonClicked(this::selectLeftEntryValues);</b>
<b class="nc">&nbsp;        toolbar.setOnSelectRightEntryValuesButtonClicked(this::selectRightEntryValues);</b>
&nbsp;
<b class="nc">&nbsp;        toolbar.showDiffProperty().addListener(e -&gt; updateDiff());</b>
<b class="nc">&nbsp;        toolbar.diffViewProperty().addListener(e -&gt; updateDiff());</b>
<b class="nc">&nbsp;        toolbar.diffHighlightingMethodProperty().addListener(e -&gt; updateDiff());</b>
<b class="nc">&nbsp;        toolbar.hideEqualFieldsProperty().addListener(e -&gt; showOrHideEqualFields());</b>
&nbsp;
<b class="nc">&nbsp;        updateDiff();</b>
<b class="nc">&nbsp;        showOrHideEqualFields();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void showOrHideEqualFields() {
<b class="nc">&nbsp;        for (FieldRowView row : fieldRows) {</b>
<b class="nc">&nbsp;            if (toolbar.shouldHideEqualFields()) {</b>
<b class="nc">&nbsp;                if (row.hasEqualLeftAndRightValues()) {</b>
<b class="nc">&nbsp;                    row.hide();</b>
&nbsp;                }
&nbsp;            } else {
<b class="nc">&nbsp;                row.show();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void updateDiff() {
<b class="nc">&nbsp;        if (toolbar.shouldShowDiffs()) {</b>
<b class="nc">&nbsp;            for (FieldRowView row : fieldRows) {</b>
<b class="nc">&nbsp;                if (&quot;Groups&quot;.equals(row.getFieldNameCell().getText()) &amp;&amp; (row.getLeftValueCell().getText().contains(keywordSeparator) || row.getRightValueCell().getText().contains(keywordSeparator))) {</b>
<b class="nc">&nbsp;                    row.showDiff(new ShowDiffConfig(toolbar.getDiffView(), new GroupDiffMode(keywordSeparator)));</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    row.showDiff(new ShowDiffConfig(toolbar.getDiffView(), toolbar.getDiffHighlightingMethod()));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            fieldRows.forEach(FieldRowView::hideDiff);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void initializeHeaderView() {
<b class="nc">&nbsp;        headerView.getColumnConstraints().addAll(fieldNameColumnConstraints,</b>
&nbsp;                leftEntryColumnConstraints,
&nbsp;                rightEntryColumnConstraints,
&nbsp;                mergedEntryColumnConstraints);
&nbsp;    }
&nbsp;
&nbsp;    private void initializeScrollPane() {
<b class="nc">&nbsp;        scrollPane.setFitToWidth(true);</b>
<b class="nc">&nbsp;        scrollPane.setHbarPolicy(ScrollPane.ScrollBarPolicy.NEVER);</b>
<b class="nc">&nbsp;        scrollPane.setContent(mergeGridPane);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void initializeColumnConstraints() {
<b class="nc">&nbsp;        fieldNameColumnConstraints.setHgrow(Priority.NEVER);</b>
<b class="nc">&nbsp;        leftEntryColumnConstraints.setHgrow(Priority.ALWAYS);</b>
<b class="nc">&nbsp;        rightEntryColumnConstraints.setHgrow(Priority.ALWAYS);</b>
<b class="nc">&nbsp;        mergedEntryColumnConstraints.setHgrow(Priority.ALWAYS);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void initializeMergeGridPane() {
<b class="nc">&nbsp;        mergeGridPane.getColumnConstraints().addAll(fieldNameColumnConstraints, leftEntryColumnConstraints, rightEntryColumnConstraints, mergedEntryColumnConstraints);</b>
&nbsp;
<b class="nc">&nbsp;        for (int fieldIndex = 0; fieldIndex &lt; viewModel.numberOfVisibleFields(); fieldIndex++) {</b>
<b class="nc">&nbsp;            addRow(fieldIndex);</b>
&nbsp;
<b class="nc">&nbsp;            mergeGridPane.getRowConstraints().add(new RowConstraints());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private Field getFieldAtIndex(int index) {
<b class="nc">&nbsp;        return viewModel.getVisibleFields().get(index);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void addRow(int fieldIndex) {
<b class="nc">&nbsp;        Field field = getFieldAtIndex(fieldIndex);</b>
&nbsp;
&nbsp;        FieldRowView fieldRow;
<b class="nc">&nbsp;        if (field.getProperties().contains(FieldProperty.PERSON_NAMES)) {</b>
<b class="nc">&nbsp;            fieldRow = new PersonsNameFieldRowView(field, getLeftEntry(), getRightEntry(), getMergedEntry(), fieldMergerFactory, preferences, fieldIndex);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            fieldRow = new FieldRowView(field, getLeftEntry(), getRightEntry(), getMergedEntry(), fieldMergerFactory, preferences, fieldIndex);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        fieldRows.add(fieldIndex, fieldRow);</b>
&nbsp;
<b class="nc">&nbsp;        mergeGridPane.add(fieldRow.getFieldNameCell(), 0, fieldIndex);</b>
<b class="nc">&nbsp;        mergeGridPane.add(fieldRow.getLeftValueCell(), 1, fieldIndex);</b>
<b class="nc">&nbsp;        mergeGridPane.add(fieldRow.getRightValueCell(), 2, fieldIndex);</b>
<b class="nc">&nbsp;        mergeGridPane.add(fieldRow.getMergedValueCell(), 3, fieldIndex);</b>
&nbsp;    }
&nbsp;
&nbsp;    public BibEntry getMergedEntry() {
<b class="nc">&nbsp;        return viewModel.getMergedEntry();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setLeftHeader(String leftHeader) {
<b class="nc">&nbsp;        headerView.setLeftHeader(leftHeader);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void setRightHeader(String rightHeader) {
<b class="nc">&nbsp;        headerView.setRightHeader(rightHeader);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void selectLeftEntryValues() {
<b class="nc">&nbsp;        fieldRows.forEach(FieldRowView::selectLeftValue);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void selectRightEntryValues() {
<b class="nc">&nbsp;        fieldRows.forEach(FieldRowView::selectRightValue);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void showDiff(ShowDiffConfig diffConfig) {
<b class="nc">&nbsp;        toolbar.setDiffView(diffConfig.diffView());</b>
<b class="nc">&nbsp;        toolbar.setDiffHighlightingMethod(diffConfig.diffHighlightingMethod());</b>
<b class="nc">&nbsp;        toolbar.setShowDiff(true);</b>
&nbsp;    }
&nbsp;
&nbsp;    public BibEntry getLeftEntry() {
<b class="nc">&nbsp;        return viewModel.getLeftEntry();</b>
&nbsp;    }
&nbsp;
&nbsp;    public BibEntry getRightEntry() {
<b class="nc">&nbsp;        return viewModel.getRightEntry();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void saveConfiguration() {
<b class="nc">&nbsp;        toolbar.saveToolbarConfiguration();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void autoSelectBetterFields() {
<b class="nc">&nbsp;        for (FieldRowView row : fieldRows) {</b>
<b class="nc">&nbsp;            row.autoSelectBetterValue();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private static BibEntry safeClone(BibEntry primary, BibEntry peer) {
<b class="nc">&nbsp;        if (primary != null) {</b>
<b class="nc">&nbsp;            return new BibEntry(primary);</b>
&nbsp;        }
<b class="nc">&nbsp;        BibEntry placeholder = peer != null &amp;&amp; peer.getType() != null</b>
<b class="nc">&nbsp;                               ? new BibEntry(peer.getType())</b>
<b class="nc">&nbsp;                               : new BibEntry();</b>
<b class="nc">&nbsp;        if (peer != null) {</b>
<b class="nc">&nbsp;            peer.getCitationKey().ifPresent(placeholder::withCitationKey);</b>
&nbsp;        }
<b class="nc">&nbsp;        return placeholder;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-09-29 22:51</div>
</div>
</body>
</html>

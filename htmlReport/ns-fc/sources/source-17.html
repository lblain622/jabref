


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > Version</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.jabref.logic.util</a>
</div>

<h1>Coverage Summary for Class: Version (org.jabref.logic.util)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">Version</td>
<td class="coverageStat">
  <span class="percent">
    27.8%
  </span>
  <span class="absValue">
    (5/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    15.3%
  </span>
  <span class="absValue">
    (11/72)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    28.6%
  </span>
  <span class="absValue">
    (32/112)
  </span>
</td>
</tr>
  <tr>
    <td class="name">Version$DevelopmentStage</td>
<td class="coverageStat">
  <span class="percent">
    60%
  </span>
  <span class="absValue">
    (3/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    40%
  </span>
  <span class="absValue">
    (8/20)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    34.8%
  </span>
  <span class="absValue">
    (8/23)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    13.4%
  </span>
  <span class="absValue">
    (11/82)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    30.3%
  </span>
  <span class="absValue">
    (40/132)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.jabref.logic.util;
&nbsp;
&nbsp;import java.io.BufferedReader;
&nbsp;import java.io.IOException;
&nbsp;import java.io.InputStreamReader;
&nbsp;import java.net.HttpURLConnection;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;import java.util.Objects;
&nbsp;import java.util.Optional;
&nbsp;import java.util.regex.Matcher;
&nbsp;import java.util.regex.Pattern;
&nbsp;
&nbsp;import kong.unirest.core.json.JSONArray;
&nbsp;import kong.unirest.core.json.JSONObject;
&nbsp;import org.slf4j.Logger;
&nbsp;import org.slf4j.LoggerFactory;
&nbsp;
&nbsp;/**
&nbsp; * Represents the Application Version with the major and minor number, the full Version String and if it&#39;s a developer version
&nbsp; */
&nbsp;public class Version {
&nbsp;
&nbsp;    public static final String JABREF_DOWNLOAD_URL = &quot;https://downloads.jabref.org&quot;;
&nbsp;
<b class="fc">&nbsp;    private static final Version UNKNOWN_VERSION = new Version();</b>
&nbsp;
<b class="fc">&nbsp;    private final static Pattern VERSION_PATTERN = Pattern.compile(&quot;(?&lt;major&gt;\\d+)(\\.(?&lt;minor&gt;\\d+))?(\\.(?&lt;patch&gt;\\d+))?(?&lt;stage&gt;-alpha|-beta)?(?&lt;num&gt;\\d+)?(?&lt;dev&gt;-?dev)?.*&quot;);</b>
<b class="fc">&nbsp;    private final static Pattern CI_SUFFIX_PATTERN = Pattern.compile(&quot;-ci\\.\\d+&quot;);</b>
&nbsp;
&nbsp;    private static final String JABREF_GITHUB_RELEASES = &quot;https://api.github.com/repos/JabRef/JabRef/releases&quot;;
&nbsp;
<b class="fc">&nbsp;    private String fullVersion = BuildInfo.UNKNOWN_VERSION;</b>
<b class="fc">&nbsp;    private int major = -1;</b>
<b class="fc">&nbsp;    private int minor = -1;</b>
<b class="fc">&nbsp;    private int patch = -1;</b>
<b class="fc">&nbsp;    private DevelopmentStage developmentStage = DevelopmentStage.UNKNOWN;</b>
<b class="fc">&nbsp;    private int developmentNum = -1;</b>
&nbsp;    private boolean isDevelopmentVersion;
&nbsp;
&nbsp;    /**
&nbsp;     * Dummy constructor to create a local object (and  {@link Version#UNKNOWN_VERSION})
&nbsp;     */
<b class="fc">&nbsp;    private Version() {</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Tinylog does not allow for altering existing loging configuraitons after the logger was initialized .
&nbsp;     * Lazy initialization to enable tinylog writing to a file (and also still enabling loggin in this class)
&nbsp;     */
&nbsp;    private static Logger getLogger() {
<b class="nc">&nbsp;        return LoggerFactory.getLogger(Version.class);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @param version must be in form of following pattern: {@code (\d+)(\.(\d+))?(\.(\d+))?(-alpha|-beta)?(-?dev)?} (e.g., 3.3; 3.4-dev)
&nbsp;     * @return the parsed version or {@link Version#UNKNOWN_VERSION} if an error occurred
&nbsp;     */
&nbsp;    public static Version parse(String version) {
<b class="pc">&nbsp;        if ((version == null) || version.isEmpty() || BuildInfo.UNKNOWN_VERSION.equals(version)</b>
<b class="pc">&nbsp;                || &quot;${version}&quot;.equals(version)) {</b>
<b class="fc">&nbsp;            return UNKNOWN_VERSION;</b>
&nbsp;        }
&nbsp;
<b class="fc">&nbsp;        Version parsedVersion = new Version();</b>
&nbsp;
&nbsp;        // remove &quot;-ci.1&quot; suffix
<b class="fc">&nbsp;        Matcher ciSuffixMatcher = CI_SUFFIX_PATTERN.matcher(version);</b>
<b class="fc">&nbsp;        version = ciSuffixMatcher.replaceAll(&quot;&quot;);</b>
&nbsp;
<b class="fc">&nbsp;        parsedVersion.fullVersion = version;</b>
<b class="fc">&nbsp;        Matcher matcher = VERSION_PATTERN.matcher(version);</b>
<b class="pc">&nbsp;        if (matcher.find()) {</b>
&nbsp;            try {
<b class="fc">&nbsp;                parsedVersion.major = Integer.parseInt(matcher.group(&quot;major&quot;));</b>
&nbsp;
<b class="fc">&nbsp;                String minorString = matcher.group(&quot;minor&quot;);</b>
<b class="pc">&nbsp;                parsedVersion.minor = minorString == null ? 0 : Integer.parseInt(minorString);</b>
&nbsp;
<b class="fc">&nbsp;                String patchString = matcher.group(&quot;patch&quot;);</b>
<b class="pc">&nbsp;                parsedVersion.patch = patchString == null ? 0 : Integer.parseInt(patchString);</b>
&nbsp;
<b class="fc">&nbsp;                String versionStageString = matcher.group(&quot;stage&quot;);</b>
<b class="pc">&nbsp;                parsedVersion.developmentStage = versionStageString == null ? DevelopmentStage.STABLE : DevelopmentStage.parse(versionStageString);</b>
&nbsp;
<b class="fc">&nbsp;                String stageNumString = matcher.group(&quot;num&quot;);</b>
<b class="pc">&nbsp;                parsedVersion.developmentNum = stageNumString == null ? 0 : Integer.parseInt(stageNumString);</b>
&nbsp;
<b class="pc">&nbsp;                parsedVersion.isDevelopmentVersion = matcher.group(&quot;dev&quot;) != null;</b>
&nbsp;            } catch (NumberFormatException e) {
<b class="nc">&nbsp;                getLogger().warn(&quot;Invalid version string used: {}&quot;, version, e);</b>
<b class="nc">&nbsp;                return UNKNOWN_VERSION;</b>
&nbsp;            } catch (IllegalArgumentException e) {
<b class="nc">&nbsp;                getLogger().warn(&quot;Invalid version pattern is used&quot;, e);</b>
<b class="nc">&nbsp;                return UNKNOWN_VERSION;</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            getLogger().warn(&quot;Version could not be recognized by the pattern&quot;);</b>
<b class="nc">&nbsp;            return UNKNOWN_VERSION;</b>
&nbsp;        }
<b class="fc">&nbsp;        return parsedVersion;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Grabs all the available releases from the GitHub repository
&nbsp;     */
&nbsp;    public static List&lt;Version&gt; getAllAvailableVersions() throws IOException {
<b class="nc">&nbsp;        HttpURLConnection connection = (HttpURLConnection) URLUtil.create(JABREF_GITHUB_RELEASES).openConnection();</b>
<b class="nc">&nbsp;        connection.setRequestProperty(&quot;Accept-Charset&quot;, &quot;UTF-8&quot;);</b>
<b class="nc">&nbsp;        try (BufferedReader rd = new BufferedReader(new InputStreamReader(connection.getInputStream()))) {</b>
<b class="nc">&nbsp;            JSONArray objects = new JSONArray(rd.readLine());</b>
<b class="nc">&nbsp;            List&lt;Version&gt; versions = new ArrayList&lt;&gt;(objects.length());</b>
<b class="nc">&nbsp;            for (int i = 0; i &lt; objects.length(); i++) {</b>
<b class="nc">&nbsp;                JSONObject jsonObject = objects.getJSONObject(i);</b>
<b class="nc">&nbsp;                Version version = Version.parse(jsonObject.getString(&quot;tag_name&quot;).replaceFirst(&quot;v&quot;, &quot;&quot;));</b>
<b class="nc">&nbsp;                versions.add(version);</b>
&nbsp;            }
<b class="nc">&nbsp;            connection.disconnect();</b>
<b class="nc">&nbsp;            return versions;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return true if this version is newer than the passed one
&nbsp;     */
&nbsp;    public boolean isNewerThan(Version otherVersion) {
<b class="nc">&nbsp;        Objects.requireNonNull(otherVersion);</b>
<b class="nc">&nbsp;        if (Objects.equals(this, otherVersion)) {</b>
<b class="nc">&nbsp;            return false;</b>
<b class="nc">&nbsp;        } else if (BuildInfo.UNKNOWN_VERSION.equals(this.getFullVersion())) {</b>
<b class="nc">&nbsp;            return false;</b>
<b class="nc">&nbsp;        } else if (BuildInfo.UNKNOWN_VERSION.equals(otherVersion.getFullVersion())) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // compare the majors
<b class="nc">&nbsp;        if (this.getMajor() &gt; otherVersion.getMajor()) {</b>
<b class="nc">&nbsp;            return true;</b>
<b class="nc">&nbsp;        } else if (this.getMajor() == otherVersion.getMajor()) {</b>
&nbsp;            // if the majors are equal compare the minors
<b class="nc">&nbsp;            if (this.getMinor() &gt; otherVersion.getMinor()) {</b>
<b class="nc">&nbsp;                return true;</b>
<b class="nc">&nbsp;            } else if (this.getMinor() == otherVersion.getMinor()) {</b>
&nbsp;                // if the minors are equal compare the patch numbers
<b class="nc">&nbsp;                if (this.getPatch() &gt; otherVersion.getPatch()) {</b>
<b class="nc">&nbsp;                    return true;</b>
<b class="nc">&nbsp;                } else if (this.getPatch() == otherVersion.getPatch()) {</b>
&nbsp;                    // if the patch numbers are equal compare the development stages
<b class="nc">&nbsp;                    if (this.developmentStage.isMoreStableThan(otherVersion.developmentStage)) {</b>
<b class="nc">&nbsp;                        return true;</b>
<b class="nc">&nbsp;                    } else if (this.developmentStage == otherVersion.developmentStage) {</b>
&nbsp;                        // if the development stage are equal compare the development number
<b class="nc">&nbsp;                        if (this.getDevelopmentNum() &gt; otherVersion.getDevelopmentNum()) {</b>
<b class="nc">&nbsp;                            return true;</b>
<b class="nc">&nbsp;                        } else if (this.getDevelopmentNum() == otherVersion.getDevelopmentNum()) {</b>
&nbsp;                            // if the stage is equal check if this version is in development and the other is not
<b class="nc">&nbsp;                            return !this.isDevelopmentVersion &amp;&amp; otherVersion.isDevelopmentVersion;</b>
&nbsp;                        }
&nbsp;                    }
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return false;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Checks if this version should be updated to one of the given ones. Ignoring the other Version if this one is Stable and the other one is not.
&nbsp;     *
&nbsp;     * @return The version this one should be updated to, or an empty Optional
&nbsp;     */
&nbsp;    public Optional&lt;Version&gt; shouldBeUpdatedTo(List&lt;Version&gt; availableVersions) {
<b class="nc">&nbsp;        Optional&lt;Version&gt; newerVersion = Optional.empty();</b>
<b class="nc">&nbsp;        for (Version version : availableVersions) {</b>
<b class="nc">&nbsp;            if (this.shouldBeUpdatedTo(version)</b>
<b class="nc">&nbsp;                    &amp;&amp; (newerVersion.isEmpty() || version.isNewerThan(newerVersion.get()))) {</b>
<b class="nc">&nbsp;                newerVersion = Optional.of(version);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return newerVersion;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Checks if this version should be updated to the given one. Ignoring the other Version if this one is Stable and the other one is not.
&nbsp;     *
&nbsp;     * @return True if this version should be updated to the given one
&nbsp;     */
&nbsp;    public boolean shouldBeUpdatedTo(Version otherVersion) {
&nbsp;        // ignoring the other version if it is not stable, except if this version itself is not stable
<b class="nc">&nbsp;        if (developmentStage == Version.DevelopmentStage.STABLE</b>
&nbsp;                &amp;&amp; otherVersion.developmentStage != Version.DevelopmentStage.STABLE) {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // check if the other version is newer than given one
<b class="nc">&nbsp;        return otherVersion.isNewerThan(this);</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getFullVersion() {
<b class="fc">&nbsp;        return fullVersion;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getMajor() {
<b class="nc">&nbsp;        return major;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getMinor() {
<b class="nc">&nbsp;        return minor;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getPatch() {
<b class="nc">&nbsp;        return patch;</b>
&nbsp;    }
&nbsp;
&nbsp;    public int getDevelopmentNum() {
<b class="nc">&nbsp;        return developmentNum;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isDevelopmentVersion() {
<b class="nc">&nbsp;        return isDevelopmentVersion;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * @return The link to the changelog on GitHub to this specific version (https://github.com/JabRef/jabref/blob/vX.X/CHANGELOG.md)
&nbsp;     */
&nbsp;    public String getChangelogUrl() {
<b class="nc">&nbsp;        if (isDevelopmentVersion) {</b>
<b class="nc">&nbsp;            return &quot;https://github.com/JabRef/jabref/blob/main/CHANGELOG.md#unreleased&quot;;</b>
&nbsp;        } else {
<b class="nc">&nbsp;            StringBuilder changelogLink = new StringBuilder()</b>
<b class="nc">&nbsp;                    .append(&quot;https://github.com/JabRef/jabref/blob/v&quot;)</b>
<b class="nc">&nbsp;                    .append(this.getMajor())</b>
<b class="nc">&nbsp;                    .append(&quot;.&quot;)</b>
<b class="nc">&nbsp;                    .append(this.getMinor());</b>
&nbsp;
<b class="nc">&nbsp;            if (this.getPatch() != 0) {</b>
<b class="nc">&nbsp;                changelogLink</b>
<b class="nc">&nbsp;                        .append(&quot;.&quot;)</b>
<b class="nc">&nbsp;                        .append(this.getPatch());</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            changelogLink</b>
<b class="nc">&nbsp;                    .append(this.developmentStage.stage);</b>
&nbsp;
<b class="nc">&nbsp;            if (this.getDevelopmentNum() != 0) {</b>
<b class="nc">&nbsp;                changelogLink</b>
<b class="nc">&nbsp;                        .append(this.getDevelopmentNum());</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            changelogLink.append(&quot;/CHANGELOG.md&quot;);</b>
&nbsp;
<b class="nc">&nbsp;            return changelogLink.toString();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean equals(Object other) {
<b class="nc">&nbsp;        if (this == other) {</b>
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!(other instanceof Version)) {</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // till all the information are stripped from the fullversion this should suffice
<b class="nc">&nbsp;        return this.getFullVersion().equals(((Version) other).getFullVersion());</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int hashCode() {
<b class="nc">&nbsp;        return getFullVersion().hashCode();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String toString() {
<b class="fc">&nbsp;        return this.getFullVersion();</b>
&nbsp;    }
&nbsp;
<b class="fc">&nbsp;    public enum DevelopmentStage {</b>
<b class="fc">&nbsp;        UNKNOWN(&quot;&quot;, 0),</b>
<b class="fc">&nbsp;        ALPHA(&quot;-alpha&quot;, 1),</b>
<b class="fc">&nbsp;        BETA(&quot;-beta&quot;, 2),</b>
<b class="fc">&nbsp;        STABLE(&quot;&quot;, 3);</b>
&nbsp;
&nbsp;        /**
&nbsp;         * describes how stable this stage is, the higher the better
&nbsp;         */
&nbsp;        private final int stability;
&nbsp;        private final String stage;
&nbsp;
<b class="fc">&nbsp;        DevelopmentStage(String stage, int stability) {</b>
<b class="fc">&nbsp;            this.stage = stage;</b>
<b class="fc">&nbsp;            this.stability = stability;</b>
&nbsp;        }
&nbsp;
&nbsp;        public static DevelopmentStage parse(String stage) {
<b class="nc">&nbsp;            if (stage == null) {</b>
<b class="nc">&nbsp;                getLogger().warn(&quot;The stage cannot be null&quot;);</b>
<b class="nc">&nbsp;                return UNKNOWN;</b>
<b class="nc">&nbsp;            } else if (stage.equals(STABLE.stage)) {</b>
<b class="nc">&nbsp;                return STABLE;</b>
<b class="nc">&nbsp;            } else if (stage.equals(ALPHA.stage)) {</b>
<b class="nc">&nbsp;                return ALPHA;</b>
<b class="nc">&nbsp;            } else if (stage.equals(BETA.stage)) {</b>
<b class="nc">&nbsp;                return BETA;</b>
&nbsp;            }
<b class="nc">&nbsp;            getLogger().warn(&quot;Unknown development stage: {}&quot;, stage);</b>
<b class="nc">&nbsp;            return UNKNOWN;</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * @return true if this stage is more stable than the {@code otherStage}
&nbsp;         */
&nbsp;        public boolean isMoreStableThan(DevelopmentStage otherStage) {
<b class="nc">&nbsp;            return this.stability &gt; otherStage.stability;</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-09-29 22:51</div>
</div>
</body>
</html>
